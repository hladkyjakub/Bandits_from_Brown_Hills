#textdomain wesnoth-Bandits_from_Brown_Hills
[scenario]
    name= _ "Raid"
    id=01_Raid
    map_file="01_Raid_a.map"
    next_scenario=02_Pursuit
    victory_when_enemies_defeated=no
    {GLOBAL__DROPPABLE_MINERAL_WATER merman_mineral_water}
    {DEFAULT_SCHEDULE}
    {TURNS 12 12 12}
    {IMPLEMENT_AMLA_CUSTOM}
    {IMPLEMENT_ABILITIES_CUSTOM}
    {IMPLEMENT_LOAD_COUNTER}
    experience_modifier=100
    [music]
        name=revelation.ogg
        play_once=yes
        ms_after=2000
    [/music]
    [event]
        name=preload
        [lua]
             code=<<
local _ = wesnoth.textdomain "wesnoth-Bandits_from_Brown_Hills" --Idk how to use it???
local f_side_playing = wesnoth.interface.game_display.side_playing
function wesnoth.interface.game_display.side_playing()
	local g = f_side_playing()
	if wesnoth.current.side == 1 then --add elseif for more variants
        g[1][2].tooltip="BB (Band of Bandits)"
	else
        g[1][2].tooltip="I dunno"
    end
	return g
end
local f_turn = wesnoth.interface.game_display.turn
function wesnoth.interface.game_display.turn()
	local g = f_turn()
	if (wesnoth.scenario.turns - wml.variables["turn_number"]) < 6 then
        g[1][2].tooltip="Turn number\n\n        Maybe we should hurry?"
    else
        g[1][2].tooltip="Turn number\n\n        Thats a lot of time!"
    end
	return g
end
local f_gold = wesnoth.interface.game_display.gold
function wesnoth.interface.game_display.gold()
	local g = f_gold()
	if type(g[1][2].text) ~= "number" then
		num = g[1][2].text:gsub("<[^>]+>", "")
	else
		num = g[1][2].text
	end
	if num and tonumber(num) < 0 then
		g[1][2].tooltip="Financial crisis\n\n        = no gold'"
	else
		g[1][2].tooltip="<span color='#FFD700'>Gold pieces\n\n        I kinda love them...</span>"
	end
	return g
end
local f_villages = wesnoth.interface.game_display.villages
function wesnoth.interface.game_display.villages()
	local g = f_villages()
	if type(g[1][2].text) ~= "number" then
		str = g[1][2].text:gsub("<[^>]+>", "")
	else
		str = g[1][2].text
	end
	num = str:match(".-/(.*)")
	if tonumber(num) < 1 then
        g[1][2].tooltip="Money generators\n\n        None in sight"
    else
        num = str:match("(.-)/")
        if tonumber(num) < 1 then
            g[1][2].tooltip="Money generators\n\n        We have none... poor us"
        else
            g[1][2].tooltip="Money generators\n\n        #stonks"
        end
    end
	return g
end
local f_num_units = wesnoth.interface.game_display.num_units
function wesnoth.interface.game_display.num_units()
	local g = f_num_units()
	num = tonumber(g[1][2].text)
	if num == 1 then
		g[1][2].tooltip="Oh\n\n        ... Sh*t!"
	else
		g[1][2].tooltip="My boys\n\n        C'mon!"
	end
	return g
end
local f_upkeep = wesnoth.interface.game_display.upkeep
function wesnoth.interface.game_display.upkeep()
	local g = f_upkeep()
	if type(g[1][2].text) ~= "number" then
		str = g[1][2].text:gsub("<[^>]+>", "")
	else
		str = g[1][2].text
	end
	num = str:gsub("%b()", "")
	if tonumber(num) < 1 then
		g[1][2].tooltip="Upkeep\n\n        No upkeep"
	else
		g[1][2].tooltip="Upkeep\n\n        The minus side of band"
	end
	return g
end
local f_income = wesnoth.interface.game_display.income
function wesnoth.interface.game_display.income()
	local g = f_income()
	if type(g[1][2].text) ~= "number" then
		num = g[1][2].text:gsub("<[^>]+>", "")
	else
		num = g[1][2].text
	end
	if tonumber(num) < 0 then
		g[1][2].tooltip="Expense\n\n        Gamble is always an option"
	else
		g[1][2].tooltip="Income\n\n        Making money"
	end
	return g
end
local f_report_countdown = wesnoth.interface.game_display.report_countdown
function wesnoth.interface.game_display.report_countdown()
	local g = f_report_countdown()
	g[2][2].tooltip="Tick-Tack\n\n        Not sure if it works..."
	return g
end
local f_unit_name = wesnoth.interface.game_display.unit_name
function wesnoth.interface.game_display.unit_name()
	local g = f_unit_name()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.id == "jareth" then
            g[1][2].tooltip="Coolest guy EVER!"
        elseif u.name == "" then
            g[1][2].tooltip="Monster... Here?"
        else
            g[1][2].tooltip="The term 'name' typically refers to a word or set of words by which a person, animal, place, thing, or concept is known, addressed, or referred to. Essentially, it is a label or identifier used to distinguish one entity from another. Names are used extensively in human communication for various purposes, including identification, reference, and communication. They play a crucial role in our everyday lives, allowing us to recognize and interact with the people, objects, and ideas around us."
        end
    end
	return g
end
local f_unit_type = wesnoth.interface.game_display.unit_type
function wesnoth.interface.game_display.unit_type()
	local g = f_unit_type()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        g[1][2].tooltip="Looks like The Creator hadn't time to list all different unit types..."
    end
	return g
end
local f_unit_side = wesnoth.interface.game_display.unit_side
function wesnoth.interface.game_display.unit_side()
	local g = f_unit_side()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.side == 1 then
            g[1][2].tooltip="BB (Band of Bandits)"
            g[2][2].tooltip="BB (Band of Bandits)"
        else
            g[1][2].tooltip="I dunno"
            g[2][2].tooltip="I dunno"
        end
    end
	return g
end
local f_unit_xp = wesnoth.interface.game_display.unit_xp
function wesnoth.interface.game_display.unit_xp()
	local g = f_unit_xp()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.experience == 1 then
            g[1][2].tooltip="One experience"
        elseif u.experience == 69 then
            g[1][2].tooltip="Nice!"
        elseif u.experience > (u.max_experience * 0.8) then
            if u.side == 1 then
                g[1][2].tooltip="Yeah!"
            else
                g[1][2].tooltip="<span color='#FF0000'>WARNING!!! HIGH XP UNIT DETECTED !!!WARNING</span>"
            end
        else
            g[1][2].tooltip="Experience Points"
        end
    end
	return g
end
local f_unit_alignment = wesnoth.interface.game_display.unit_alignment
function wesnoth.interface.game_display.unit_alignment()
	local g = f_unit_alignment()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.alignment == "neutral" then
            g[1][2].tooltip="Hmm... boring"
        elseif u.alignment == "chaotic" then
            g[1][2].tooltip="Best aligment ever!"
        elseif u.alignment == "lawful" then
            g[1][2].tooltip="'lawful' The flattest aligment ever!"
        elseif u.alignment == "liminal" then
            g[1][2].tooltip="Oh MAN!"
        else
            g[1][2].tooltip="Nuh uh?"
        end
    end
	return g
end
local f_unit_race = wesnoth.interface.game_display.unit_race
function wesnoth.interface.game_display.unit_race()
	local g = f_unit_race()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.race == "human" then
            g[1][2].tooltip="We"
        elseif u.race == "dwarf" then
            g[1][2].tooltip="Cave human"
        elseif u.race == "naga" then
            g[1][2].tooltip="Water sss's"
        elseif u.race == "merfolk" then
            g[1][2].tooltip="WaterMan"
        elseif u.race == "lizard" then
            g[1][2].tooltip="Sss's"
        elseif u.race == "orc" then
            g[1][2].tooltip="With muscles like boulders and brain like... slightly smaller boulder"
        elseif u.race == "monster" then
            g[1][2].tooltip="What the hell is that?"
        elseif u.race == "goblin" then
            g[1][2].tooltip="Small, sneaky, and always up to no good"
        elseif u.race == "bats" then
            g[1][2].tooltip="Flying furball of fangs"
        elseif u.race == "wolf" then
            g[1][2].tooltip="Degenerated dog(cats are better)"
        else
            g[1][2].tooltip="???"
        end
    end
	return g
end
local f_terrain_info = wesnoth.interface.game_display.terrain_info
function wesnoth.interface.game_display.terrain_info()
	local g = f_terrain_info()
	if wesnoth.interface.get_selected_hex() and g ~= {} and wesnoth.interface.get_hovered_hex() == nil then
        local i = 1
        while g[i] and g[i][2] and g[i][2].tooltip ~= nil do
            if g[i][2].tooltip == "Castle" then
                g[i][2].tooltip="Walls"
            elseif g[i][2].tooltip == "Cave" then
                g[i][2].tooltip="Dwarven Tunnels"
            elseif g[i][2].tooltip == "Coastal Reef" then
                g[i][2].tooltip="Water with Stones"
            elseif g[i][2].tooltip == "Deep Water" then
                g[i][2].tooltip="Deep fluid"
            elseif g[i][2].tooltip == "Flat" then
                g[i][2].tooltip="You don't mean this seriously, do you?\nDo you need the 'Flat' tooltip?"
            elseif g[i][2].tooltip == "Forest" then
                g[i][2].tooltip="Trees"
            elseif g[i][2].tooltip == "Frozen" then
                g[i][2].tooltip="Cold"
            elseif g[i][2].tooltip == "Fungus" then
                g[i][2].tooltip="Spore"
            elseif g[i][2].tooltip == "Hills" then
                g[i][2].tooltip="Not-Flat"
            elseif g[i][2].tooltip == "Impassable" then
                g[i][2].tooltip="How the hell have you got there?!!"
            elseif g[i][2].tooltip == "Mountains" then
                g[i][2].tooltip="Big Stones"
            elseif g[i][2].tooltip == "Sand" then
                g[i][2].tooltip="Little Stones"
            elseif g[i][2].tooltip == "Shallow Water" then
                g[i][2].tooltip="Low Water"
            elseif g[i][2].tooltip == "Swamp" then
                g[i][2].tooltip="Wetland"
            elseif g[i][2].tooltip == "Unwalkable" then
                g[i][2].tooltip="Unwalkable\n\n        Don't you dare to explore it"
            elseif g[i][2].tooltip == "Village" then
                g[i][2].tooltip="Settlement"
            else
                g[i][2].tooltip="???"
            end
            i = i + 1
        end
    end
	return g
end
             >>
        [/lua]
    [/event]
    [event]
        name=prestart
        [set_variable]
            name=variable_with_zero
            value=0
        [/set_variable]
        [set_variable]
            name=loop_number
            value=0
        [/set_variable]
        [set_variable]
            name=game_number
            value=starting_value
        [/set_variable]
        [while]
            [variable]
                name=game_number
                not_equals=""
            [/variable]
            [do]
                [set_variable]
                    name=loop_number
                    add=1
                [/set_variable]
                [get_global_variable]
                    namespace=Bandits_from_Brown_Hills.loads.$loop_number|.1
                    from_global=1
                    to_local=game_number
                    side=1
                [/get_global_variable]
            [/do]
        [/while]
        [set_variable]
            name=game_number
            to_variable=loop_number
        [/set_variable]
        {CLEAR_VARIABLE loop_number}
        [set_variable]
            name=scenario_number
            value=1
        [/set_variable]
        [music]
            name=knolls.ogg
            ms_before=12000
            append=no
        [/music]
        [music]
            name=wanderer.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=battle.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=transience.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=the_king_is_dead.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=knalgan_theme.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=the_city_falls.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=nunc_dimittis.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=revelation.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=loyalists.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=breaking_the_chains.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=elvish-theme.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=legends_of_the_north.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=traveling_minstrels.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=underground.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=vengeful.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=frantic.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=the_dangerous_symphony.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=heroes_rite.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=suspense.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=the_deep_path.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=siege_of_laurelmor.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=casualties_of_war.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=silvan_sanctuary.ogg
            ms_before=12000
            append=yes
        [/music]
        [music]
            name=battle-epic.ogg
            ms_before=12000
            append=yes
        [/music]
        ### Defining Dwarven leaders and dwarven magic item  and second leader's traits ###
        {VARIABLE_OP dwarven_magic_item rand (Boots of speed, Breastplate of the mighty, Diadem of intelligence, Ring of strengt, Huntsmans hat, Ankh)}
        [switch]
            variable=dwarven_magic_item
            [case]
                value="Boots of speed"
                {VARIABLE_OP second_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
                {VARIABLE second_dwarven_leader_title "the Quickfooted"}
            [/case]
            [case]
                value="Breastplate of the mighty"
                {VARIABLE_OP second_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
                {VARIABLE second_dwarven_leader_title "Stone Warden"}
            [/case]
            [case]
                value="Diadem of intelligence"
                {VARIABLE_OP second_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
                {VARIABLE second_dwarven_leader_title "Sagebeard"}
            [/case]
            [case]
                value="Ring of strengt"
                {VARIABLE_OP second_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
                {VARIABLE second_dwarven_leader_title "Ironhand"}
            [/case]
            [case]
                value="Huntsmans hat"
                {VARIABLE_OP second_dwarven_leader_type rand (Dwarvish Thunderguard, Dwarvish Pathfinder, Dwarvish Stalwart)}
                {VARIABLE second_dwarven_leader_title "the Sharpshooted"}
            [/case]
            [case]
                value="Ankh"
                {VARIABLE_OP second_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
                {VARIABLE second_dwarven_leader_title "the Invincible"}
            [/case]
            [else]
                #shouldn't happend, but to be sure...
                {VARIABLE_OP second_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
                {VARIABLE second_dwarven_leader_title "the Great"}
            [/else]
        [/switch]
        [switch]
            variable=second_dwarven_leader_type
            [case]
                value="Dwarvish Steelclad"
                {VARIABLE_OP first_dwarven_leader_type rand (Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
            [/case]
            [case]
                value="Dwarvish Stalwart"
                {VARIABLE_OP first_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
            [/case]
            [case]
                value="Dwarvish Thunderguard"
                {VARIABLE_OP first_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Runesmith, Dwarvish Pathfinder)}
            [/case]
            [case]
                value="Dwarvish Runesmith"
                {VARIABLE_OP first_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Pathfinder)}
            [/case]
            [case]
                value="Dwarvish Pathfinder"
                {VARIABLE_OP first_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith)}
            [/case]
            [else]
                #shouldn't happend, but to be sure...
                {VARIABLE_OP first_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
            [/else]
        [/switch]
        {VARIABLE_OP third_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
        [while]
            [variable]
                name=third_dwarven_leader_type
                equals=$first_dwarven_leader_type
            [/variable]
            [or]
                [variable]
                    name=third_dwarven_leader_type
                    equals=$second_dwarven_leader_type
                [/variable]
            [/or]
            [do]
                {VARIABLE_OP third_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
            [/do]
        [/while]
        {VARIABLE_OP fourth_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
        [while]
            [variable]
                name=fourth_dwarven_leader_type
                equals=$first_dwarven_leader_type
            [/variable]
            [or]
                [variable]
                    name=fourth_dwarven_leader_type
                    equals=$second_dwarven_leader_type
                [/variable]
            [/or]
            [or]
                [variable]
                    name=fourth_dwarven_leader_type
                    equals=$third_dwarven_leader_type
                [/variable]
            [/or]
            [do]
                {VARIABLE_OP fourth_dwarven_leader_type rand (Dwarvish Steelclad, Dwarvish Stalwart, Dwarvish Thunderguard, Dwarvish Runesmith, Dwarvish Pathfinder)}
            [/do]
        [/while]
        [switch]
            variable=third_dwarven_leader_type
            [case]
                value="Dwarvish Steelclad"
                {VARIABLE third_dwarven_leader_type "Dwarvish Lord"}
            [/case]
            [case]
                value="Dwarvish Stalwart"
                {VARIABLE third_dwarven_leader_type "Dwarvish Sentinel"}
            [/case]
            [case]
                value="Dwarvish Thunderguard"
                {VARIABLE third_dwarven_leader_type "Dwarvish Dragonguard"}
            [/case]
            [case]
                value="Dwarvish Runesmith"
                {VARIABLE third_dwarven_leader_type "Dwarvish Runemaster"}
            [/case]
            [case]
                value="Dwarvish Pathfinder"
                {VARIABLE third_dwarven_leader_type "Dwarvish Explorer"}
            [/case]
            [else]
                #shouldn't happend, but to be sure...
                {VARIABLE_OP third_dwarven_leader_type rand (Dwarvish Lord, Dwarvish Sentinel, Dwarvish Dragonguard, Dwarvish Runemaster, Dwarvish Explorer)}
            [/else]
        [/switch]
        [switch]
            variable=fourth_dwarven_leader_type
            [case]
                value="Dwarvish Steelclad"
                {VARIABLE fourth_dwarven_leader_type "Dwarvish Lord"}
            [/case]
            [case]
                value="Dwarvish Stalwart"
                {VARIABLE fourth_dwarven_leader_type "Dwarvish Sentinel"}
            [/case]
            [case]
                value="Dwarvish Thunderguard"
                {VARIABLE fourth_dwarven_leader_type "Dwarvish Dragonguard"}
            [/case]
            [case]
                value="Dwarvish Runesmith"
                {VARIABLE fourth_dwarven_leader_type "Dwarvish Runemaster"}
            [/case]
            [case]
                value="Dwarvish Pathfinder"
                {VARIABLE fourth_dwarven_leader_type "Dwarvish Explorer"}
            [/case]
            [else]
                #shouldn't happend, but to be sure...
                {VARIABLE_OP fourth_dwarven_leader_type rand (Dwarvish Lord, Dwarvish Sentinel, Dwarvish Dragonguard, Dwarvish Runemaster, Dwarvish Explorer)}
            [/else]
        [/switch]
    [/event]
    {VILLAGE_RAID 17 21 village_raid_1}
    {VILLAGE_RAID 2 19 village_raid_2}
    {VILLAGE_RAID 13 16 village_raid_3}
    {VILLAGE_RAID 4 12 village_raid_4}
    {VILLAGE_RAID 18 9 village_raid_5}
    {VILLAGE_RAID 17 4 village_raid_6}
    {VILLAGE_RAID 24 26 village_raid_7}
    [modify_unit_type]
        type=Peasant
        set_advances_to=Spearman
    [/modify_unit_type]
    [modify_unit_type]
        type=Woodsman
        set_advances_to=Bowman
    [/modify_unit_type]
    [modify_unit_type]
        type=Spearman
        set_advances_to=Javelineer, Pikeman
    [/modify_unit_type]
    [story]
        [part]
            show_title=no
            {BANDITS_BIGMAP_CLEAR}
            story= _ "<span size='70000' font_family='Oldania ADF Std' ><span color='#baac7d'>Narrator</span>
This story is about Jareth, a young man who leads a small group of bandits and poachers from Brown Hills.</span>"
            text_alignment="center"
            {OLD_REST 400 615}
        [/part]
        [part]
            show_title=no
            {BANDITS_BIGMAP_CLEAR}
            story= _ "<span size='70000' font_family='Oldania ADF Std' ><span color='#baac7d'>Narrator</span>
Life in Brown Hills is harsh and dangerous.</span>"
            text_alignment="center"
            {OLD_REST 400 615}
        [/part]
        [part]
            show_title=no
            {BANDITS_BIGMAP_CLEAR}
            story= _ "<span size='70000' font_family='Oldania ADF Std' ><span color='#baac7d'>Narrator</span>
One day, another outlaw arrived. He went by the name Wenrys.</span>"
            text_alignment="center"
            {OLD_REST 400 615}
        [/part]
        [part]
            show_title=no
            {BANDITS_BIGMAP_CLEAR}
            story= _ "<span size='70000' font_family='Oldania ADF Std' ><span color='#baac7d'>Narrator</span>
He told Jareth that he knows about a nearby caravan full of gold, poorly protected.</span>"
            text_alignment="center"
            {OLD_REST 400 615}
        [/part]
        [part]
            show_title=no
            {BANDITS_BIGMAP_CLEAR}
            story= _ "<span size='70000' font_family='Oldania ADF Std' ><span color='#baac7d'>Narrator</span>
Jareth agreed to a plan and they joined forces to capture the gold. He crossed the Great River with his men and went in search of the caravan.</span>"
            text_alignment="center"
            {OLD_REST 400 615}
        [/part]
        {BANDITS_BIGMAP {JOURNEY_01_NEW} "Raid"}
    [/story]
    [side]
        side=1
        type=Outlaw
        name=_"Wenrys"
        unrenamable=yes
        id=wenrys
        experience={ON_DIFFICULTY 3 5 7}
        [modifications]
            {TRAIT_QUICK}
            {TRAIT_RESILIENT}
        [/modifications]
        facing=se
        controller=human
        color=green
        side_name=_"Bandits"
        team_name=bandits
        user_team_name= _ "Bandits"
        recruit=Thug, Footpad, Poacher
        {FLAG_VARIANT6 ragged}
        {GOLD 90 70 60}
        persistent=yes
        save_id=bandits
        #bandits(player)
    [/side]
    [side]
        side=2
        type=Lieutenant
        name= _ "Sir Rillon"
        facing=sw
        id=rillon
        experience={ON_DIFFICULTY 15 27 39}
        [modifications]
            {TRAIT_INTELLIGENT}
            {TRAIT_DEXTROUS}
        [/modifications]
        controller=ai
        color=blue
        side_name=_"Humans"
        team_name=enemy
        user_team_name= _ "Humans"
        {FLAG_VARIANT loyalist}
        {GOLD 30 40 50}
        income=-3
#ifdef HARD
        recruit=Spearman, Short Swordsman, Bowman, Heavy Infantryman
#else
        recruit=Spearman, Short Swordsman, Bowman
#endif
        [ai]
            recruitment_pattern=fighter, fighter, archer
            aggression=0.01
            caution=0.99
            grouping = defensive
        [/ai]
        #humans
    [/side]
    [side]
        side=3
        controller=ai
        color=green
        team_name=enemy
        side_name=_"Wenrys"
        user_team_name= _ "Wenrys"
        {FLAG_VARIANT6 ragged}
        #Wenrys
    [/side]
    [side]
        side=4
        controller=ai
        color=purple
        team_name=enemy
        side_name=_"Dwarves"
        user_team_name= _ "Dwarves"
        gold=0
        {FLAG_VARIANT knalgan}
        #dwarves
    [/side]
    [side]
        side=5
        controller=ai
        color=orange
        team_name=enemy
        side_name=_"Mermans"
        user_team_name= _ "Mermans"
        {FLAG_VARIANT long}
        #mermans
    [/side]
#TODO add random enemy
#     [side]
#         side=6
#         controller=ai
#         color=black
#         team_name=enemy
#         user_team_name= _ "Enemy"
#         {FLAG_VARIANT6 ragged}
#         #random enemy
#     [/side]
    [event]
        name=prestart
        {VARIABLE village_raid_1 0}
        {VARIABLE village_raid_2 0}
        {VARIABLE village_raid_3 0}
        {VARIABLE village_raid_4 0}
        {VARIABLE village_raid_5 0}
        {VARIABLE village_raid_6 0}
        {VARIABLE village_raid_7 0}
        {VARIABLE epilogue_version 0 }
        {VARIABLE caravan_captured 0 }
        {VARIABLE caravan_in_castle 0 }
        {VARIABLE amla_basic_informations_has_been_sad 0 }
        [set_variable]
            name=friendly_sides
            value=1
        [/set_variable]
        [set_variable]
            name=rillon_is_defeated
            value=0
        [/set_variable]
        [objectives]
            side=1
            [objective]
                description= _ "Steal the gold"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Jareth or Wenrys"
                condition=lose
            [/objective]
            [objective]
                description= _ "Caravan gets out unharmed (Turns run out)"
                condition=lose
            [/objective]
            [gold_carryover]
                bonus=no
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
        [modify_side]
            side=3,4,5,6
            hidden=yes
        [/modify_side]
        [unit]
            type=Ruffian
            side=1
            name= _ "Jareth"
            unrenamable=yes
            id=jareth
            experience={ON_DIFFICULTY 8 6 5}
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_RESILIENT}
            [/modifications]
            x,y=1,26
            advances_to=Footpad, Thug, Poacher
        [/unit]
        [capture_village]
            side=2
            x,y=8,4,19,2,18,9,4,12,13,16,2,18,17,21,4,25,24,26
        [/capture_village]
        [item]
            x, y=5,3
            image="items/grain-sheaf.png"
        [/item]
        [item]
            x, y=14,15
            image="items/grain-sheaf.png"
        [/item]
        [item]
            x, y=9,8
            image="items/scarecrow.png"
        [/item]
    [/event]
    [event]
        name=start
        [micro_ai]
            side=2
            ai_type=lurkers
            action=add
            [filter]
                id=rillon
            [/filter]
            [filter_location]
                terrain=K*^*
            [/filter_location]
            [filter_location_wander]
                terrain=K*^*
            [/filter_location_wander]
        [/micro_ai]
        {SPEAKING (id=wenrys) "We have to raid that caravan, boys."}
        {SPEAKING (id=jareth) "I should get myself some weapons."}
        {MOVE_UNIT (id=jareth) 4 25}
        [capture_village]
            side=1
            x,y=4,25
        [/capture_village]
        [terrain]
            x,y=4,25
            terrain=Gd^Vhr
        [/terrain]
        [redraw]
            side=1
        [/redraw]
        [sound]
            name=fire.wav
        [/sound]
        [delay]
            time=1000
        [/delay]
        {VARIABLE_OP first_peasant_type rand (Peasant,Woodsman)}
        [move_unit_fake]
            type=$first_peasant_type
            x=4,3
            y=25,24
            side=2
        [/move_unit_fake]
        [unit]
            type=$first_peasant_type
            side=2
            x,y=3,24
            experience=10
            id=first_peasant
        [/unit]
        {CLEAR_VARIABLE first_peasant_type}
        {SPEAKING (id=jareth) "What weapons should I use?"}
        [transform_unit]
            id=jareth
        [/transform_unit]
        [store_unit]
            [filter]
                id=jareth
            [/filter]
        [/store_unit]
        [set_variable]
            name=jareth_profession
            value=$unit.type
        [/set_variable]
        [if]
            [variable]
                name=jareth_profession
                equals=Footpad
            [/variable]
            [then]
                [modify_unit]
                    [filter]
                        id=jareth
                    [/filter]
                    {TRAIT_QUICK}
                [/modify_unit]
            [/then]
            [else]
                [if]
                    [variable]
                        name=jareth_profession
                        equals=Poacher
                    [/variable]
                    [then]
                        [modify_unit]
                            [filter]
                                id=jareth
                            [/filter]
                            {TRAIT_DEXTROUS}
                        [/modify_unit]
                    [/then]
                    [else]
                        [modify_unit]
                            [filter]
                                id=jareth
                            [/filter]
                            {TRAIT_STRONG}
                        [/modify_unit]
                    [/else]
                [/if]
            [/else]
        [/if]
        [heal_unit]
            id=jareth
            moves=full
            amount=full
        [/heal_unit]
        {SPEAKING (id=first_peasant) "My home!!!"}
        {MOVE_UNIT (id=first_peasant) 8 3}
        {SPEAKING (id=first_peasant) "Sir, bandits! They are raiding our farms!"}
        {SPEAKING (id=rillon) "Soldiers, sortie!"}
        {SPEAKING (id=rillon) "We must protect our people and the approaching gold caravan!"}
        {BUILD_CAMP (id=wenrys) 5 24}
        {BUILD_CAMP (id=wenrys) 6 23}
#ifdef HARD
#else
        {BUILD_CAMP (id=wenrys) 7 23}
#endif
        {BUILD_CAMP (id=wenrys) 8 23}
#ifdef EASY
        {BUILD_CAMP (id=wenrys) 9 24}
#endif
        {BUILD_CAMP (id=wenrys) 8 24}
        {MOVE_UNIT (id=wenrys) 7 24}
        {BUILD_CAMP_KEEP (id=wenrys) 7 24}
    [/event]
    [event]
        name=unit placed
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [object]
            silent=yes
            id=unwalkable_vision_costs_2
            take_only_once=no
            [filter]
                x,y=$x1,$y1
                [not]
                    [filter_wml]
                        [modifications]
                            [object]
                                id="unwalkable_vision_costs_2"
                            [/object]
                        [/modifications]
                    [/filter_wml]
                [/not]
            [/filter]
            [effect]
                apply_to=vision_costs
                replace=yes
                [vision_costs]
                    unwalkable=2
                [/vision_costs]
            [/effect]
        [/object]
    [/event]
    [event]
        name=recruit
        [filter]
            side=1
        [/filter]
        first_time_only=no
        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 4 3 2}"}
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=recruit
        id=recruit_xp_before_marshal
        [filter]
            side=2
        [/filter]
        first_time_only=no
        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 7 8 9}"}
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=recruit
        [filter]
            side=4
        [/filter]
        first_time_only=no
        {VARIABLE_OP units_experience rand "5..{ON_DIFFICULTY 10 12 15}"}
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=side 2 turn 2 refresh
        [unit]
            type="Caravan"
            side=2
            x,y=1,5
            animate=yes
            facing=sw
            id=caravan
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Spearman"
            side=2
            x,y=1,4
            animate=yes
            facing=sw
            id=caravan_guard_1
            experience=34
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type="Short Swordsman"
            side=2
            x,y=1,6
            animate=yes
            facing=sw
            id=caravan_guard_2
            experience=24
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_SLOW}
            [/modifications]
        [/unit]
        [micro_ai]
            side=2
            ai_type=zone_guardian
            action=add
            id=caravan_guard_1, caravan_guard_2
            [filter_location]
                terrain=C*^*
                x,y=1-18,1-9
            [/filter_location]
            [filter_location_enemy]
                x,y=1-18,1-9
            [/filter_location_enemy]
        [/micro_ai]
        [micro_ai]
            side=2
            ai_type=return_guardian
            action=add
            id=caravan
            return_x,return_y=10,4
        [/micro_ai]
        {SPEAKING (id=caravan_guard_1) "We made it! Now we are going to hide the gold in that castle until Sir Meory arrives."}
    [/event]
    [event]
        name=moveto
        [filter]
            id="caravan"
            x,y=10,4
        [/filter]
        [if]
            [have_unit]
                side=2
                id=caravan_guard_1
            [/have_unit]
            [then]
                {SPEAKING (id=caravan_guard_1) "Sir, can we hide this orcish gold inside your castle?"}
            [/then]
            [else]
                [if]
                    [have_unit]
                        side=2
                        id=caravan_guard_2
                    [/have_unit]
                    [then]
                        {SPEAKING (id=caravan_guard_2) "Sir, we will hide this orcish gold inside your castle."}
                    [/then]
                    [else]
                        {SPEAKING (id=caravan) "Phew, I made it, but it was really dangerous. I'll hide this orcish gold inside you castle, Sir."}
                    [/else]
                [/if]
            [/else]
        [/if]
        {SPEAKING (id=rillon) "You have my permission. You and your gold will be safe here."}
        [kill]
            id=caravan
        [/kill]
        [set_variable]
            name=caravan_in_castle
            value=1
        [/set_variable]
        [item]
            x,y=11,4
            image="items/chest.png"
        [/item]
    [/event]
    [event]
        name=last breath
        [filter]
            id="wenrys"
            side=1
        [/filter]
        {SPEAKING (id=wenrys) "Ahh. . ."}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id="wenrys"
            side=3
        [/filter]
        {SPEAKING (id=wenrys) "You think you can get me?"}
        [item]
            name=smoke_screen_1
            x,y=$x1, $y1
            halo="halo/dragonguard/dg-muzzle-flash-se-[1~17].png~GS(), misc/blank-hex.png:[80*3,90,100,120*3,100*9,999999]"
        [/item]
        [item]
            name=smoke_screen_2
            x,y=$x1, $y1
            halo="halo/dragonguard/dg-muzzle-flash-s-[1~17].png~GS(), misc/blank-hex.png:[80*3,90,100,120*3,100*9,999999]"
        [/item]
        [item]
            name=smoke_screen_3
            x,y=$x1, $y1
            halo="halo/dragonguard/dg-muzzle-flash-ne-[1~17].png~GS(), misc/blank-hex.png:[80*3,90,100,120*3,100*9,999999]"
        [/item]
        [item]
            name=smoke_screen_4
            x,y=$x1, $y1
            halo="halo/dragonguard/dg-muzzle-flash-n-[1~17].png~GS(), misc/blank-hex.png:[80*3,90,100,120*3,100*9,999999]"
        [/item]
        [item]
            name=smoke_screen_5
            x,y=$x1, $y1
            halo="halo/dragonguard/dg-muzzle-flash-se-[1~17].png~GS()~FL(horizontal), misc/blank-hex.png:[80*3,90,100,120*3,100*9,999999]"
        [/item]
        [item]
            name=smoke_screen_6
            x,y=$x1, $y1
            halo="halo/dragonguard/dg-muzzle-flash-ne-[1~17].png~GS()~FL(horizontal), misc/blank-hex.png:[80*3,90,100,120*3,100*9,999999]"
        [/item]
        [item]
            name=smoke_screen_7
            x,y=$x1, $y1
            halo="projectiles/fireball-fail-[1~7].png~SCALE(200,200), misc/blank-hex.png:[100*9,999999]"
        [/item]
        [modify_unit]
            [filter]
                [filter_adjacent]
                    id=wenrys
                    is_enemy=yes
                [/filter_adjacent]
                [not]
                    status=stunned
                [/not]
            [/filter]
            [object]
                silent=yes
                duration=turn end
                [effect]
                    apply_to=image_mod
                    replace="CS(50,50,0)"
                [/effect]
                [effect]
                    apply_to=zoc
                    value=no
                [/effect]
                [effect]
                    apply_to=movement
                    increase=-50%
                [/effect]
                [effect]
                    apply_to=status
                    add=stunned
                [/effect]
            [/object]
        [/modify_unit]
        [redraw]
        [/redraw]
        [store_unit]
            [filter]
                id=wenrys
            [/filter]
            variable=wenrys_stored
            kill=yes
        [/store_unit]
        [sound]
            name=gunshot.wav
        [/sound]
        [delay]
            time=2000
        [/delay]
        [remove_item]
            x,y=$x1, $y1
        [/remove_item]
        {SPEAKING (id=jareth) "What's that? Where is he?"}
        {SPEAKING (id=jareth) "Dont let him flee, he can't go far. Get him!"}
        {VARIABLE epilogue_version 1 }
        [fire_event]
            name=cavalry_comes
        [/fire_event]
        [fire_event]
            name=marshal_comes
        [/fire_event]
        [store_unit]
            [filter]
                id=jareth
            [/filter]
            variable=jareth_stored
        [/store_unit]
        [if]
            [have_unit]
                id=glerary
            [/have_unit]
            [then]
                [store_unit]
                    [filter]
                        id=glerary
                    [/filter]
                    variable=glerary_stored
                [/store_unit]
            [/then]
        [/if]
        [if]
            [have_unit]
                id=meory
            [/have_unit]
            [then]
                [store_unit]
                    [filter]
                        id=meory
                    [/filter]
                    variable=meory_stored
                [/store_unit]
            [/then]
        [/if]
        [store_unit]
            [filter]
                side=2
                [not]
                    id=meory,glerary
                [/not]
            [/filter]
            variable=human_loyal_units
        [/store_unit]
        {VARIABLE_OP scenario_number add 1}
        [endlevel]
            result=victory
            bonus=no
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id="glerary"
        [/filter]
        {SPEAKING (id=glerary) "These bandits are strong."}
        {SPEAKING (id=glerary) "But I'll come back."}
        {SPEAKING (id=jareth) "Heh."}
#TODO this isnt working
#         [if]
#             [have_unit]
#                 id=glerary
#                 [filter_location]
#                     x=46-66,47-66,49-66,50-66,51-66,53-66,55-66,55,57-66,58-66,61-66,63-66,65,67,46-67
#                     y=1-2,3-5,6-7,8,9,10,11,12,12,13,14,15,16,0-15,0
#                 [/filter_location]
#             [/have_unit]
#             [then]
#                 {MOVE_UNIT (id=glerary) 58 13}
#                 {TELEPORT_UNIT (id=glerary) 54 15}
#             [/then]
#         [/if]
        {MOVE_UNIT (id=glerary) 58 13}
        {TELEPORT_UNIT (id=glerary) 54 15}
        {MOVE_UNIT (id=glerary) 37 27}
        [if]
            [have_unit]
                id=meory
            [/have_unit]
            [then]
            [/then]
            [else]
                [modify_unit]
                    [filter]
                        id=glerary
                    [/filter]
                    {TRAIT_LOYAL_HERO}
                    canrecruit=no
                [/modify_unit]
            [/else]
        [/if]
        [store_unit]
            [filter]
                id=glerary
            [/filter]
            variable=glerary_stored
            kill=yes
        [/store_unit]
    [/event]
    [event]
        name=last breath
        [filter]
            id="meory"
        [/filter]
        {SPEAKING (id=meory) "These bandits are horribly strong!"}
        {SPEAKING (id=meory) "But I'll come back."}
        {SPEAKING (id=jareth) "Hah!"}
        {MOVE_UNIT (id=meory) 1 5}
        [store_unit]
            [filter]
                id=meory
            [/filter]
            variable=meory_stored
            kill=yes
        [/store_unit]
    [/event]
    [event]
        name=last breath
        [filter]
            id="jareth"
        [/filter]
        {SPEAKING (id=jareth) "And so ... here ends my story."}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=enter_hex
        id=mermaid ambush
        first_time_only=yes
        [filter]
            side=1
            x,y=50,11
        [/filter]
        [unit]
            type="Merman Fighter"
            side=5
            x,y=50,10
            animate=yes
            id=merman
            experience={ON_DIFFICULTY 16 18 20}
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        [micro_ai]
            side=5
            id=merman
            ai_type=return_guardian
            action=add
            return_x,return_y=50,10
        [/micro_ai]
        {SPEAKING (id=merman) "What are you doing in Triton's Sanctuary?"}
        [message]
            speaker=$unit.id
            message= _ ". . ."
            [option]
                label= _ "Nothing, we're leaving."
                [command]
                    {SPEAKING (id=merman) "And I don't want to see you here anymore! Get out!"}
                    [kill]
                        id=merman,mermaid
                    [/kill]
                    [terrain]
                        x=50,49
                        y=10,10
                        terrain=Mm^Xm
                    [/terrain]
                    [remove_item]
                        x,y=49,10
                    [/remove_item]
                [/command]
            [/option]
            [option]
                label= _ "Die, damn mermans!"
                [command]
                [/command]
            [/option]
        [/message]
    [/event]
    [event]
        name=last breath
        [filter]
            id="caravan"
        [/filter]
        {VARIABLE caravan_captured 1 }
        [store_unit]
            [filter]
                x,y=$x1, $y1
            [/filter]
            variable=caravan_location
        [/store_unit]
        [item]
            x,y=$x1, $y1
            image="items/chest.png"
        [/item]
        {SPEAKING (id=jareth) "Hey, this chest must be full of gold."}
        {SPEAKING (id=wenrys) "Man, let it be, we have to kill them all first!"}
    [/event]
    [event]
        name=last breath
        [filter]
            id="rillon"
        [/filter]
        {VARIABLE rillon_level $unit.level }
        [store_unit]
            [filter]
                x,y=$x2, $y2
            [/filter]
        [/store_unit]
        [if]
            #these two wont get xp otherwise for killing
            [variable]
                name=unit.id
                equals=jareth
            [/variable]
            [then]
                [modify_unit]
                    [filter]
                        id=jareth
                    [/filter]
                    [effect]
                        apply_to=experience
                        increase="$( $rillon_level * 8 )"
                    [/effect]
                [/modify_unit]
            [/then]
            [else]
                [if]
                    [variable]
                        name=unit.id
                        equals=wenrys
                    [/variable]
                    [then]
                        [modify_unit]
                            [filter]
                                id=wenrys
                            [/filter]
                            [effect]
                                apply_to=experience
                                increase="$( $rillon_level * 8 )"
                            [/effect]
                        [/modify_unit]
                    [/then]
                [/if]
            [/else]
        [/if]
        {VARIABLE rillon_is_defeated 1}
        {SPEAKING (id=rillon) "Soldiers, retreat! We can't take them out!"}
        [kill]
            id=rillon
            animate=yes
        [/kill]
        [micro_ai]
            side=2
            ai_type=zone_guardian
            action=delete
        [/micro_ai]
        [micro_ai]
            side=2
            ai_type=goto
            action=add
            ignore_enemy_at_goal=yes
            [filter_location]
                x,y=1,5
            [/filter_location]
        [/micro_ai]
        [modify_side]
            side=2
            [ai]
                grouping = no
                aggression=0.99
                caution=0.01
            [/ai] 
        [/modify_side]
        [set_variable]
            name=villager_talked
            value=0
        [/set_variable]
        {VILLAGERS_FLEEING 17 21 village_raid_1}
        {VILLAGERS_FLEEING 2 19 village_raid_2}
        {VILLAGERS_FLEEING 13 16 village_raid_3}
        {VILLAGERS_FLEEING 4 12 village_raid_4}
        {VILLAGERS_FLEEING 18 9 village_raid_5}
        {VILLAGERS_FLEEING 17 4 village_raid_6}
        {VILLAGERS_FLEEING 24 26 village_raid_7}
        {NARRATION () "Rest of the guards and peasants will try to escape along the road to (1,5), you DON'T have to kill them."}
        [if]
            [have_unit]
                side=2
            [/have_unit]
            [then]
                {HIGHLIGHT_IMAGE 1 5 scenery/signpost.png ()}
            [/then]
        [/if]
        {MOVE_UNIT (id=wenrys) 11 4}
        [if]
            [have_unit]
                side=2
                x,y=10,4
            [/have_unit]
            [then]
                [capture_village]
                    x=10
                    y=4
                [/capture_village]
            [/then]
            [else]
                [capture_village]
                    side=1
                    x=10
                    y=4
                [/capture_village]
            [/else]
        [/if]
        [terrain]
            x,y=11,4
            terrain=Khr
        [/terrain]
        [terrain]
            x,y=10,4
            terrain=Rp^Vhcr
        [/terrain]
        [terrain]
            x,y=10,5
            terrain=Chr^Edt
        [/terrain]
        [terrain]
            x,y=12,5
            terrain=Chr^Edt
        [/terrain]
        [terrain]
            x,y=12,4
            terrain=Ch^Edt
        [/terrain]
        [terrain]
            x,y=11,5
            terrain=Ch^Edt
        [/terrain]
        [terrain]
            x,y=10,3
            terrain=Ch^Edt
        [/terrain]
        [redraw]
            side=1
        [/redraw]
        [sound]
            name=torch.ogg
        [/sound]
        [delay]
            time=500
        [/delay]
        [if]
            [variable]
                name=caravan_in_castle
                equals=0
            [/variable]
            [and]
                [variable]
                    name=caravan_captured
                    equals=0
                [/variable]
            [/and]
            [then]
                {SPEAKING (id=wenrys) "Give us the gold, or we will take it by force."}
                {SPEAKING (id=caravan) "Okay, okay, okay, calm down! I'll give it to you."}
                {MOVE_UNIT (id=caravan) 11 4}
                [item]
                    x, y=11,4
                    image="items/chest-open.png"
                [/item]
                {MOVE_UNIT (id=caravan) 1 5}
                [kill]
                    id=caravan
                [/kill]
            [/then]
        [/if]
        {SPEAKING (id=wenrys) "Good work, boys. Let's see how much gold is in the chest."}
        [if]
            [variable]
                name=caravan_captured
                equals=1
            [/variable]
            [then]
                {SPEAKING (id=wenrys) "Jareth, bring it here"}
                {MOVE_UNIT (id=jareth) $caravan_location.x $caravan_location.y}
                [remove_item]
                    image="items/chest.png"
                [/remove_item]
                {MOVE_UNIT (id=jareth) 11 4}
                [item]
                    x, y=11,4
                    image="items/chest-open.png"
                [/item]
                [sound]
                    name=gold.ogg
                [/sound]
                [delay]
                    time=500
                    accelerate=yes
                [/delay]
                {SPEAKING (id=wenrys) "Oh! I've never seen so much gold! I'm rich!"}
            [/then]
            [else]
                [if]
                    [variable]
                        name=caravan_in_castle
                        equals=1
                    [/variable]
                    [then]
                        [remove_item]
                            image="items/chest.png"
                        [/remove_item]
                        [item]
                            x, y=11,4
                            image="items/chest-open.png"
                        [/item]
                        [sound]
                            name=gold.ogg
                        [/sound]
                        [delay]
                            time=500
                            accelerate=yes
                        [/delay]
                        {SPEAKING (id=wenrys) "Oh! I've never seen so much gold! I'm rich!"}
                        {MOVE_UNIT (id=jareth) 11 4}
                    [/then]
                [/if]
            [/else]
        [/if]
        [if]
            [variable]
                name=caravan_in_castle
                equals=0
            [/variable]
            [and]
                [variable]
                    name=caravan_captured
                    equals=0
                [/variable]
            [/and]
            [then]
                [remove_item]
                    image="items/chest.png"
                [/remove_item]
                [item]
                    x, y=11,4
                    image="items/chest-open.png"
                [/item]
                [sound]
                    name=gold.ogg
                [/sound]
                [delay]
                    time=500
                    accelerate=yes
                [/delay]
                {SPEAKING (id=wenrys) "Oh! I've never seen so much gold together! I'm rich!"}
                {MOVE_UNIT (id=jareth) 11 4}
                [kill]
                    id=caravan
                [/kill]
            [/then]
        [/if]
        {SPEAKING (id=jareth) "So..."}
        {SPEAKING (id=jareth) "How much do we get?"}
        {SPEAKING (id=wenrys) "What?! Why should I pay you? You were useless."}
        [modify_unit]
            [filter]
                id=wenrys
            [/filter]
            side=3
         [/modify_unit]
         [modify_side]
            side=1
            gold=0
        [/modify_side]
        {SPEAKING (id=wenrys) "Mine!!!"}
        [replace_map]
            map_file=01_Raid_b.map
            expand=yes
            shrink=yes
        [/replace_map]
        [modify_side]
            side=1
            shroud=yes
        shroud_data="|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|11111111111111111111111111111
|00011111111111111111111111111
|00000011111111111111111111111
|00000000111111111111111111111
|00000000000111111111111111111
|00000000000111111111111111111
|00000000000111111111111111111
|00000000000111111111111111111
|00000000000111111111111111111
|00000000000001111111111111111
|00000000000001111111111111111
|00000000000001111111111111111
|00000000000000111111111111111
|00000000000000111111111111111
|00000000000000111111111111111
|00000000000000011111111111111
|00000000000000011111111111111
|00000000000000001111111111111
|00000000000000001111111111111
|00000000000000000111111111111
|00000000000000000111111111111
|00000000000000001111111111111
|00000000000000001111111111111"
        [/modify_side]
#ifdef HARD
        [terrain]
            x,y=7,23
            terrain=Gg
        [/terrain]
#endif
#ifdef EASY
        [terrain]
            x,y=9,24
            terrain=Gs^Cyk
        [/terrain]
#endif
        {VILLAGE_REPLACE 17 21 village_raid_1}
        {VILLAGE_REPLACE 2 19 village_raid_2}
        {VILLAGE_REPLACE 13 16 village_raid_3}
        {VILLAGE_REPLACE 4 12 village_raid_4}
        {VILLAGE_REPLACE 18 9 village_raid_5}
        {VILLAGE_REPLACE 17 4 village_raid_6}
        {VILLAGE_REPLACE 24 26 village_raid_7}
        [if]
            [variable]
                name=village_raid_3
                greater_than=0
            [/variable]
            [then]
                [terrain]
                    x,y=12,15
                    terrain=Gd^Gvs
                [/terrain]
                [terrain]
                    x,y=13,15
                    terrain=Gd^Gvs
                [/terrain]
                [terrain]
                    x,y=14,15
                    terrain=Gd^Gvs
                [/terrain]
                [terrain]
                    x,y=15,15
                    terrain=Gd^Gvs
                [/terrain]
            [/then]
        [/if]
        [tunnel]
            [source]
                x=41,42,42
                y=2,1,2
            [/source]
            [target]
                x=46,46,47
                y=2,1,2
            [/target]
            [filter]
            [/filter]
            pass_allied_units=yes
            bidirectional = yes
            allow_vision = yes
        [/tunnel]
        [tunnel]
            [source]
                x=44,44,45
                y=5,6,6
            [/source]
            [target]
                x=47,48,48
                y=5,4,5
            [/target]
            [filter]
            [/filter]
            pass_allied_units=yes
            bidirectional = yes
            allow_vision = yes
        [/tunnel]
        [tunnel]
            [source]
                x=54,54,55
                y=14,15,15
            [/source]
            [target]
                x=55,58
                y=12,13
            [/target]
            [filter]
            [/filter]
            pass_allied_units=yes
            bidirectional = yes
            allow_vision = yes
        [/tunnel]
        [time_area]
            current_time=0
            x="46-66,47-66,49-66,50-66,51-66,53-66,55-66,55,57-66,58-66,61-66,63-66,65,67,46-67"
            y="1-2,3-5,6-7,8,9,10,11,12,12,13,14,15,16,0-15,0"
            [time]
                blue=-25
                green=-45
                id="underground"
                image="misc/time-schedules/schedule-underground.png"
                lawful_bonus=-25
                name=_"Underground"
                red=-60
            [/time]
        [/time_area]
        {PLACE_TORCHES 49,51,51,54,56,58,57,60,61,62,63,66,66 2,4,8,5,8,10,2,4,8,10,14,3,12}
        [time_area] #this is here becouse I haven't found a way to create a PLACE_TOCHES for map edges
            include_borders=yes
            x=51-53,52,61-63,62
            y=1,0,1,0
            [time]
                name= _ "Torchlight"
                image=time/schedule-indoors-dark.png
                red=0
                green=-20
                blue=-35
            [/time]
        [/time_area]
        [item]
            x,y=32,12
            image="items/grain-sheaf.png"
        [/item]
        [item]
            x,y=58,22
            image="items/scarecrow.png"
        [/item]
        [item]
            x,y=59,23
            image="items/straw-bale1.png"
        [/item]
        {PLACE_ITEM_MINERAL_WATER 49 10 merman_mineral_water}
        [item]
            x,y=28,4
            image="scenery/signpost.png"
        [/item]
        [unit]
            type="Mermaid Initiate"
            side=5
            x,y=49,10
            canrecruit=yes
            id=mermaid
            experience={ON_DIFFICULTY 13 17 23}
            advances_to=Mermaid Enchantress
            [modifications]
                {TRAIT_INTELLIGENT}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [object]
            [filter]
                type="Mermaid Initiate"
            [/filter]
            [effect]
                apply_to=new_ability
                [abilities]
#ifdef EASY
                    {ABILITY_HEALS}
#else
                    {ABILITY_CURES}
#endif
                [/abilities]
            [/effect]
        [/object]
        [micro_ai]
            side=5
            ai_type=lurkers
            action=add
            [filter]
                id=mermaid
            [/filter]
            [filter_location]
                terrain=Chw^Vov
            [/filter_location]
            [filter_location_wander]
                terrain=Chw^Vov
            [/filter_location_wander]
        [/micro_ai]
        [capture_village]
            side=5
            x=49
            y=10
        [/capture_village]
        [remove_event]
            id=village_raid_1,village_raid_2,village_raid_3,village_raid_4,village_raid_5,village_raid_6,village_raid_7
        [/remove_event]
        {CLEAR_VARIABLE village_raid_1,village_raid_2,village_raid_3,village_raid_4,village_raid_5,village_raid_6,village_raid_7}
        {MOVE_UNIT (id=wenrys) 35 5}
        [micro_ai]
            side=3
            id=wenrys
            ai_type=goto
            action=add
            ignore_enemy_at_goal=yes
            [filter_location]
                x,y=66,1
            [/filter_location]
        [/micro_ai]
        [remove_trait]
            id=jareth
            trait_id=loyal
        [/remove_trait]
        [modify_unit]
            [filter]
                id=jareth
            [/filter]
            canrecruit=yes
        [/modify_unit]
        {SPEAKING (id=jareth) "Get him!"}
        {MOVE_UNIT (id=jareth) 11 4}
        {SPEAKING (id=jareth) "He left a few gold pieces in the chest. Should be enought to recruit a few more men. This makes it easier."}
        [sound]
            name=gold.ogg
        [/sound]
        [modify_side]
            side=1
            gold=73
        [/modify_side]
        [delay]
            time=500
            accelerate=yes
        [/delay]
        [modify_turns]
            add=36
        [/modify_turns]
        [event]
            name=moveto
            [filter]
                id=jareth
                x,y=65, 2
            [/filter]
            #you sit on the throne, to recruit some more mens (Don't blame me, this is how it works)
            [sound]
                name=sling-big-miss.ogg
            [/sound]
            [terrain]
                x,y=65,2
                terrain=Cyt
            [/terrain]
            #delay?
            #As you sait down, throne starts falling down, and prison walls starts forming around
            #sound "something went wrong in machine"
            #delay?
            #Suddenly with a loud noic=se it stops moving, Looks like this old mechanism isnt really working anymore
            #Throught you're not in prison, but You can't recruit units from there either
            #TODO
        [/event]
        [objectives]
            side=1
            [objective]
                description= _ "Get your gold back (kill Wenrys)"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Jareth"
                condition=lose
            [/objective]
            [objective]
                description= _ "Don't let yourself be surrounded (Turns run out)"
                condition=lose
            [/objective]
            [gold_carryover]
                bonus=no
                carryover_percentage=40
            [/gold_carryover]
            [note]
               description= _ "You should hurry, reinforcements are on their way."
            [/note]
        [/objectives]
    [/event]
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            id=wenrys
            x,y=66,1
        [/filter]
        [heal_unit]
            id=wenrys
            moves=full
            amount=full
        [/heal_unit]
        [micro_ai]
            side=3
            ai_type=goto
            action=delete
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=lurkers
            action=add
            [filter]
                id=wenrys
            [/filter]
            [filter_location]
                x,y=66,1
            [/filter_location]
            [filter_location_wander]
                x,y=66,1
            [/filter_location_wander]
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=2
            x,y=1,5
        [/filter]
        [if]
            [variable]
                name=rillon_is_defeated
                greater_than=0
            [/variable]
            [then]
                [kill]
                    id=$unit.id
                [/kill]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=13,16
        [/filter]
        [terrain]
            x,y=12,15
            terrain=Gd^Gvs
        [/terrain]
        [terrain]
            x,y=13,15
            terrain=Gd^Gvs
        [/terrain]
        [terrain]
            x,y=14,15
            terrain=Gd^Gvs
        [/terrain]
        [terrain]
            x,y=15,15
            terrain=Gd^Gvs
        [/terrain]
    [/event]
    [event]
        name=enter_hex
        first_time_only=yes
        [filter]
            id=wenrys
            [filter_location]
                x,y=41,2
                radius=1
            [/filter_location]
        [/filter]
        [unit]
            type=$first_dwarven_leader_type
            id=gomthalfur
            name=Gomthalfur the Voluminous
            side=4
            x,y=65,2
            canrecruit=yes
            experience={ON_DIFFICULTY 5 6 7}
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            [filter]
                id=gomthalfur
            [/filter]
            [filter_location]
                terrain=K*^*
            [/filter_location]
            [filter_location_wander]
                terrain=K*^*
            [/filter_location_wander]
        [/micro_ai]
        [modify_side]
            side=4
            income=0
            gold="$( $( $turn_number * 11 ) - 70 )"
        [/modify_side]
#ifdef HARD
        [unit]
            type=Dwarvish Stalwart
            side=4
            experience=7
            x,y=64,2
            id=dwarven_inside_guard_1
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_HEALTHY}
            [/modifications]
        [/unit]
#else
        [unit]
            type=Dwarvish Guardsman
            side=4
            experience=23
            x,y=64,2
            id=dwarven_inside_guard_1
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_HEALTHY}
            [/modifications]
        [/unit]
#endif
        [unit]
            type=Dwarvish Guardsman
            side=4
            experience={ON_DIFFICULTY 4 11 17}
            x,y=65,4
            id=dwarven_inside_guard_2
            [modifications]
                {TRAIT_HEALTHY}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [modify_unit]
            [filter]
                id=dwarven_inside_guard_1, dwarven_inside_guard_2
            [/filter]
            [trait]
                name=_"trained"
                id=trained
                description=_"Unit hardened by intense training."
                [effect]
                    apply_to=hitpoints
                    increase_total={ON_DIFFICULTY 1 3 5}
                    heal_full=yes
                [/effect]
            [/trait]
        [/modify_unit]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            [filter]
                id=dwarven_inside_guard_1
            [/filter]
            [filter_location]
                x,y=64,2
            [/filter_location]
            [filter_location_wander]
                x,y=64,2
            [/filter_location_wander]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            [filter]
                id=dwarven_inside_guard_2
            [/filter]
            [filter_location]
                x,y=65,4
            [/filter_location]
            [filter_location_wander]
                x,y=65,4
            [/filter_location_wander]
        [/micro_ai]
        [unit]
            type=Dwarvish Guardsman
            side=4
            experience={ON_DIFFICULTY 15 20 25 }
            x,y=41,2
            id=dwarven_guard_1
            [modifications]
                {TRAIT_HEALTHY}
                {TRAIT_QUICK}
            [/modifications]
            animate=yes
        [/unit]
        {SPEAKING (id=dwarven_guard_1) "Hey, what do you want?"}
        {SPEAKING (id=wenrys) "Bandits are chasing me."}
        {SPEAKING (id=wenrys) "Can I hide inside your keep?"}
        {SPEAKING (id=dwarven_guard_1) "Hmm... you know ... I shouldn't let people enter ... and it is dangerous too..."}
        {SPEAKING (id=wenrys) "What about a little gift?"}
        {SPEAKING (id=dwarven_guard_1) "Hmm...?"}
        [sound]
            name=gold.ogg
        [/sound]
        [delay]
            time=1000
            accelerate=no
        [/delay]
        {SPEAKING (id=dwarven_guard_1) "Oh, of course you can enter."}
        [objectives]
            side=1
            [objective]
                description= _ "Get your gold back (kill Wenrys)"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Jareth"
                condition=lose
            [/objective]
            [objective]
                description= _ "Don't let yourself be surrounded (Turns run out)"
                condition=lose
            [/objective]
            [gold_carryover]
                bonus=no
                carryover_percentage=40
            [/gold_carryover]
            [note]
               description= _ "You should hurry, reinforcements are on their way."
            [/note]
            [note]
               description= _ "Mountain villages represent tunnel entrances."
            [/note]
        [/objectives]
        [unit]
            type=Dwarvish Guardsman
            side=4
            experience={ON_DIFFICULTY 7 10 12}
            x,y=44,6
            id=dwarven_guard_2
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_SLOW}
            [/modifications]
            animate=yes
        [/unit]
#ifdef HARD
        [unit]
            type=Dwarvish Stalwart
            side=4
            experience=2
            x,y=54,15
            id=dwarven_guard_3
            [modifications]
                {TRAIT_SLOW}
                {TRAIT_STRONG}
            [/modifications]
            animate=yes
        [/unit]
#else
        [unit]
            type=Dwarvish Guardsman
            side=4
            experience=21
            x,y=54,15
            id=dwarven_guard_3
            [modifications]
                {TRAIT_INTELLIGENT}
                {TRAIT_STRONG}
            [/modifications]
            animate=yes
        [/unit]
#endif
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            ca_id=dwarven_guard_micro_ai
            [filter]
                id=dwarven_guard_1, dwarven_guard_2, dwarven_guard_3
            [/filter]
            [filter_location]
                terrain=Hh^Vhh
            [/filter_location]
            [filter_location_wander]
                terrain=Hh^Vhh
            [/filter_location_wander]
        [/micro_ai]
        [capture_village]
            side=4
            x=63,61,56,66,66,57,54,41,44,51,53
            y=1,4,1,4,10,8,15,2,6,7,4
        [/capture_village]
        {NARRATION () "Mountain villages are entrances into tunnels inside the mountain."}
    [/event]
    [event]
        name=moveto
        id=guard_alert_1
        first_time_only=yes
        [filter]
            side=1
            [filter_location]
                x,y=41,2
                radius=2
            [/filter_location]
        [/filter]
        {SPEAKING (id=dwarven_guard_1) "Don't even try to attack us poor "$unit.type"."}
        {SPEAKING (id=$unit.id) "Shut up, you spoiled dwarf."}
        {SPEAKING (id=dwarven_guard_1) "That's enough!"}
        {SPEAKING (id=dwarven_guard_1) "BANDITS ARE TRYING TO ATTACK US! TO ARMS!!!"}
        [fire_event]
            name=inruders_alert
        [/fire_event]
    [/event]
    [event]
        name=moveto
        id=guard_alert_2
        first_time_only=yes
        [filter]
            side=1
            [filter_location]
                x,y=44,6
                radius=2
            [/filter_location]
        [/filter]
        {SPEAKING (id=dwarven_guard_2) "Look at that poor "$unit.type", he thinks, he can challenge us!"}
        {SPEAKING (id=$unit.id) "Get out of our way, you dwarvish scum!"}
        {SPEAKING (id=dwarven_guard_2) "That will cost you your life!"}
        {SPEAKING (id=dwarven_guard_2) "BANDITS ARE TRYING TO ATTACK US! TO ARMS!!!"}
        [fire_event]
            name=inruders_alert
        [/fire_event]
    [/event]
    [event]
        name=moveto
        id=guard_alert_3
        first_time_only=yes
        [filter]
            side=1
            [filter_location]
                x,y=54,15
                radius=2
            [/filter_location]
        [/filter]
        {SPEAKING (id=dwarven_guard_3) "What do you think you are doing there, poor "$unit.type"."}
        {SPEAKING (id=$unit.id) "Hey that idiot called me poor "$unit.type", he thinks he's better. Kill him!!!"}
        {SPEAKING (id=dwarven_guard_3) "You will pay in blood!"}
        {SPEAKING (id=dwarven_guard_3) "BANDITS ARE TRYING TO ATTACK US! TO ARMS!!!"}
        [fire_event]
            name=inruders_alert
        [/fire_event]
    [/event]
    [event]
        name=inruders_alert
        [modify_side]
            side=4
            recruit=Dwarvish Fighter, Dwarvish Thunderer, Dwarvish Guardsman
            income=-2
        [/modify_side]
        [remove_event]
            id=guard_alert_1, guard_alert_2, guard_alert_3
        [/remove_event]
        #maybe add tunnels for cavalery
    [/event]
    [event]
        name=moveto
        id=dwarven_leader_in_danger
        first_time_only=yes
        [filter]
            side=1
            [filter_location]
                x,y=65, 2
                radius=3
            [/filter_location]
        [/filter]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=delete
            ca_id=dwarven_guard_micro_ai
        [/micro_ai]
    [/event]
    [event]
#TODO if ported to 1.17+ add this as achievement
        name=moveto
        [filter]
           side=1
            x,y=66,18
        [/filter]
        [unit]
            type=Elder Mage
            x,y=66,18
            name=ZombieKnightCZ
            unrenamable=yes
            id=creator
            side=1
            passable=yes
            animate=yes
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
        {SPEAKING (id=creator) "Hi!"}
        {SPEAKING (id=creator) "I've created this campaign."}
        {SPEAKING (id=creator) "I'm just wandering what are you doing there."}
        {SPEAKING (id=creator) "Here, one coin for you."}
        [store_side]
            side=1
        [/store_side]
        [modify_side]
            side=1
            gold="$($side.gold + 1)"
        [/modify_side]
        [sound]
            name=gold.ogg
        [/sound]
        [delay]
            time=1000
            accelerate=no
        [/delay]
        [kill]
            id=creator
        [/kill]
    [/event]
    [event]
        name=side 2 turn 12 refresh
        [if]
            [variable]
                name=rillon_is_defeated
                equals=0
            [/variable]
            [then]
                [if]
                    [variable]
                        name=caravan_captured
                        equals=1
                    [/variable]
                    [then]
                        {SPEAKING (id=rillon) "I should carry that treasure to safety."}
                        {MOVE_UNIT (id=rillon) $caravan_location.x $caravan_location.y}
                        [remove_item]
                            image="items/chest.png"
                        [/remove_item]
                        {MOVE_UNIT (id=rillon) 25 5}
                        [kill]
                            id=rillon
                        [/kill]
                        {SPEAKING (id=wenrys) "No! My gold!"}
                        [endlevel]
                            result=defeat
                        [/endlevel]
                    [/then]
                    [else]
                        [if]
                            [variable]
                                name=caravan_in_castle
                                equals=1
                            [/variable]
                            [then]
                                [remove_item]
                                    x, y=11,4
                                [/remove_item]
                                [unit]
                                    type="Caravan"
                                    side=2
                                    x,y=10,4
                                    animate=yes
                                    facing=sw
                                    id=caravan
                                    [modifications]
                                        {TRAIT_LOYAL}
                                    [/modifications]
                                [/unit]
                            [/then]
                        [/if]
                        {SPEAKING (id=caravan) "I should go."}
                        {MOVE_UNIT (id=caravan) 25 5}
                        [kill]
                            id=caravan
                        [/kill]
                        {SPEAKING (id=wenrys) "No! My gold!"}
                        [endlevel]
                            result=defeat
                        [/endlevel]
                    [/else]
                [/if]
            [/then]
        [/if]
    [/event]
    [event]
        name=side 2 turn 19 refresh
        [fire_event]
            name=cavalry_comes
        [/fire_event]
    [/event]
    [event]
        name=cavalry_comes
        first_time_only=yes
        [event]
            name=unit placed
            first_time_only=no
            id=horses_xp_1
            [filter]
                side=2
                type=Horseman
            [/filter]
            {VARIABLE_OP units_experience rand "{ON_DIFFICULTY 10 15 20}..{ON_DIFFICULTY 25 26 27}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        [event]
            name=unit placed
            first_time_only=no
            id=horses_xp_2
            [filter]
                side=2
                type=Knight
            [/filter]
            {VARIABLE_OP units_experience rand "24..48"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        [event]
            name=unit placed
            first_time_only=no
            id=horses_xp_3
            [filter]
                side=2
                type=Dragoon
            [/filter]
            {VARIABLE_OP units_experience rand "{ON_DIFFICULTY 3 4 5}..{ON_DIFFICULTY 10 14 18}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        {SPEAKING (
    [filter_location]
        x=37
        y=27
        radius=3
    [/filter_location]
    ) "Oh no, cavalry!"}
        [move_unit]
            [filter_location]
                x=37
                y=27
                radius=3
            [/filter_location]
            to_x=43
            to_y=22
        [/move_unit]
        [store_unit]
            [filter]
                side=2
            [/filter]
        [/store_unit]
        [if]
            [have_unit]
                side=2
            [/have_unit]
            [then]
                {SPEAKING (id=$unit.id) "Yes, stop running. Now we can take our revenge."}
            [/then]
        [/if]
        [sound]
            name=horse-canter.wav
        [/sound]
        {THREE_TRAITS_LOYAL_UNIT 2 "Knight" 37 27}
        {MOVE_UNIT (x,y=37, 27) 37 25}
        {THREE_TRAITS_LOYAL_UNIT 2 "Horseman" 36 27}
        {MOVE_UNIT (x,y=36, 27) 36 25}
        [sound]
            name=horse-canter.wav
        [/sound]
        {THREE_TRAITS_LOYAL_UNIT 2 "Horseman" 38 27}
        {MOVE_UNIT (x,y=38, 27) 38 25}
        {THREE_TRAITS_LOYAL_UNIT 2 "Horseman" 35 27}
        {MOVE_UNIT (x,y=35, 27) 35 26}
        [sound]
            name=horse-canter.wav
        [/sound]
        {THREE_TRAITS_LOYAL_UNIT 2 "Horseman" 39 27}
        {MOVE_UNIT (x,y=39, 27) 39 26}
        [unit]
            type=Grand Knight
            side=2
            name= _ "Sir Glerary"
            unrenamable=yes
            id=glerary
            animate=no
            experience={ON_DIFFICULTY 30 41 52}
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
            [/modifications]
            canrecruit=yes
            x,y=37,27
        [/unit]
        {MOVE_UNIT (x,y=37, 27) 37 26}
        [sound]
            name=horse-canter.wav
        [/sound]
        {THREE_TRAITS_LOYAL_UNIT 2 "Dragoon" 36 27}
        {MOVE_UNIT (x,y=36, 27) 36 26}
        {THREE_TRAITS_LOYAL_UNIT 2 "Dragoon" 38 27}
        {MOVE_UNIT (x,y=38, 27) 38 26}
        {THREE_TRAITS_LOYAL_UNIT 2 "Dragoon" 37 27}
        [store_unit]
            [filter]
                x,y=37,25
            [/filter]
        [/store_unit]
        {SPEAKING (id=$unit.id) "Sir, Sir Rillon's castle is destroyed!"}
        {SPEAKING (id=glerary) "I see. So the caravan was raided by someone."}
        {SPEAKING (id=$unit.id) "Sir, tracks lead to dwarven caves."}
        {SPEAKING (id=glerary) "But look at the dwarves that died there."}
        {SPEAKING (id=glerary) "Those bandits are probably fleeing through dwarven tunnels."}
        {SPEAKING (id=$unit.id) "Soldiers, get them!"}
        {SPEAKING (id=jareth) "That's bad."}
        {SPEAKING (id=jareth) "We have to hurry!"}
        [modify_side]
            side=2
            [ai]
                grouping = no
                aggression=0.99
                caution=0.01
                leader_ignores_keep=yes
                scout_village_targeting=0
                village_value=0
                villages_per_scout=0
                leader_value=0.01
            [/ai]
        [/modify_side]
        [micro_ai]
            side=2
            ai_type=goto
            action=delete
        [/micro_ai]
        [remove_event]
            id=horses_xp_1, horses_xp_2, horses_xp_3
        [/remove_event]
    [/event]
    [event]
        name=side 2 turn 24 refresh
        [fire_event]
            name=marshal_comes
        [/fire_event]
    [/event]
    [event]
        name=marshal_comes
        first_time_only=yes
        [remove_event]
            id=recruit_xp_before_marshal
        [/remove_event]
        [micro_ai]
            side=2
            ai_type=fast_ai
            action=add
            [filter]
                [not]
                    type=Paladin, Grand Knight, Cavalier, Lancer, Knight, Dragoon, Horseman, Cavalryman
                [/not]
            [/filter]
        [/micro_ai]
        [event]
            name=unit placed
            first_time_only=no
            id=generals_xp
            [filter]
                side=2
                type=General
            [/filter]
            {VARIABLE_OP units_experience rand "{ON_DIFFICULTY 20 25 30}..{ON_DIFFICULTY 68 75 82}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        [event]
            name=recruit
            [filter]
                side=2
            [/filter]
            first_time_only=no
            {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 32 36 40}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        [if]
            [variable]
                name=epilogue_version
                equals=0
            [/variable]
            [then]
                {SPEAKING (
            [filter_location]
                x=1
                y=1
                radius=14
            [/filter_location]) 
            "Another reinforcement!"}
                [move_unit]
                    [filter_location]
                        x=1
                        y=1
                        radius=14
                    [/filter_location]
                    to_x=25
                    to_y=5
                [/move_unit]
            [/then]
        [/if]
        [sound]
            name=fanfare-short.wav
        [/sound]
        {THREE_TRAITS_LOYAL_UNIT 2 "General" 1 5 }
        {MOVE_UNIT (x,y=1, 5) 4 4}
        {THREE_TRAITS_LOYAL_UNIT 2 "General" 1 6}
        {MOVE_UNIT (x,y=1, 6) 4 5}
        [sound]
            name=fanfare-short.wav
        [/sound]
        {THREE_TRAITS_LOYAL_UNIT 2 "General" 1 4 }
        {MOVE_UNIT (x,y=1, 4) 3 4}
        {THREE_TRAITS_LOYAL_UNIT 2 "General" 1 6}
        {MOVE_UNIT (x,y=1, 6) 3 6}
        [sound]
            name=fanfare-short.wav
        [/sound]
        [unit]
            type=Grand Marshal
            side=2
            name= _ "Sir Meory"
            unrenamable=yes
            id=meory
            animate=no
            experience=103
            [modifications]
                {TRAIT_INTELLIGENT}
                {TRAIT_RESILIENT}
            [/modifications]
            canrecruit=yes
            x,y=1,5
        [/unit]
        {MOVE_UNIT (id=meory) 3 5}
        {THREE_TRAITS_LOYAL_UNIT 2 "General" 1 5}
        {MOVE_UNIT (x,y=1, 5) 2 4}
        [sound]
            name=fanfare-short.wav
        [/sound]
        {THREE_TRAITS_LOYAL_UNIT 2 "General" 1 6}
        {MOVE_UNIT (x,y=1, 6) 2 5}
        [store_unit]
            [filter]
                x,y=4,5
            [/filter]
        [/store_unit]
        {SPEAKING (id=$unit.id) "Sir, look, the caravan was raided, just like what the peasants said."}
        {SPEAKING (id=meory) "That's not good. We have to find and execute those bandits!"}
        {SPEAKING (id=$unit.id) "Sir, the tracks lead to dwarven caves."}
        [if]
            [variable]
                name=epilogue_version
                equals=0
            [/variable]
            [then]
                [micro_ai]
                    side=2
                    ai_type=lurkers
                    action=add
                    [filter]
                        id=meory
                    [/filter]
                    [filter_location]
                        terrain=K*^*
                    [/filter_location]
                    [filter_location_wander]
                        terrain=K*^*
                    [/filter_location_wander]
                [/micro_ai]
                [micro_ai]
                    side=2
                    ai_type=zone_guardian
                    action=add
                    [filter]
                        x,y=12,5
                    [/filter]
                    [filter_location]
                        x,y=11,4
                        radius=3
                    [/filter_location]
                    station_x,station_y=12,5
                [/micro_ai]
                [micro_ai]
                    side=2
                    ai_type=zone_guardian
                    action=add
                    [filter]
                        x,y=10,5
                    [/filter]
                    [filter_location]
                        x,y=11,4
                        radius=3
                    [/filter_location]
                    station_x,station_y=10,5
                [/micro_ai]
                [micro_ai]
                    side=2
                    ai_type=zone_guardian
                    action=add
                    [filter]
                        x,y=13,4
                    [/filter]
                    [filter_location]
                        x,y=11,4
                        radius=3
                    [/filter_location]
                    station_x,station_y=13,4
                [/micro_ai]
                [micro_ai]
                    side=2
                    ai_type=zone_guardian
                    action=add
                    [filter]
                        x,y=9,4
                    [/filter]
                    [filter_location]
                        x,y=11,4
                        radius=3
                    [/filter_location]
                    station_x,station_y=9,4
                [/micro_ai]
                [micro_ai]
                    side=2
                    ai_type=zone_guardian
                    action=add
                    [filter]
                        x,y=12,2
                    [/filter]
                    [filter_location]
                        x,y=11,4
                        radius=3
                    [/filter_location]
                    station_x,station_y=12,2
                [/micro_ai]
                [micro_ai]
                    side=2
                    ai_type=zone_guardian
                    action=add
                    [filter]
                        x,y=10,2
                    [/filter]
                    [filter_location]
                        x,y=11,4
                        radius=3
                    [/filter_location]
                    station_x,station_y=10,2
                [/micro_ai]
                [modify_side]
                    side=2
                    recruit=Longbowman, Swordsman, Pikeman
                    gold=999999
                    [ai]
                        leader_ignores_keep=no
                    [/ai]
                [/modify_side]
                {SPEAKING (id=meory) "We will capture that castle."}
                {MOVE_UNIT (id=meory) 11 4}
                [capture_village]
                    side=2
                    x,y=10 ,4
                [/capture_village]
                {BUILD_CAMP (x,y=4, 4) 11 3}
                {BUILD_CAMP (x,y=11, 3) 12 2}
                {BUILD_CAMP (x,y=4, 5) 12 3}
                {BUILD_CAMP (x,y=12, 3) 13 4}
                {BUILD_CAMP (x,y=3, 4) 10 2}
                {MOVE_UNIT (x,y=3, 6) 12 5}
                {BUILD_CAMP (x,y=2, 4) 9 4}
                {MOVE_UNIT (x,y=2,5) 10 5}
                {SPEAKING (id=jareth) "That's really bad."}
                {SPEAKING (id=jareth) "Hurry, you fools!"}
            [/then]
        [/if]
        [modify_unit]
            [filter]
                id=glerary
            [/filter]
            {TRAIT_LOYAL_HERO}
            canrecruit=no
        [/modify_unit]
        [remove_event]
            id=generals_xp
        [/remove_event]
    [/event]
    [event]
        name=side 4 turn 48 refresh
        [move_unit]
            [filter_location]
                x=51
                y=1
                radius=1
            [/filter_location]
            to_x=52
            to_y=5
        [/move_unit]
        {LOYAL_UNIT 4 "Dwarvish Explorer" 51 1 }
        {MOVE_UNIT (x,y=51, 1) 50 1}
        {LOYAL_UNIT 4 "Dwarvish Explorer" 51 1 }
        {MOVE_UNIT (x,y=51, 1) 51 2}
        {LOYAL_UNIT 4 "Dwarvish Explorer" 51 1 }
        {MOVE_UNIT (x,y=51, 1) 52 1}
        {LOYAL_UNIT 4 "Dwarvish Explorer" 51 1 }
        [store_unit]
            [filter]
                x,y=51, 1
            [/filter]
        [/store_unit]
        {SPEAKING (id=$unit.id) "We are finally here!"}
        [move_unit]
            [filter_location]
                x=66
                y=13
                radius=1
            [/filter_location]
            to_x=61
            to_y=11
        [/move_unit]
        {LOYAL_UNIT 4 "Dwarvish Dragonguard" 66 13 }
        {MOVE_UNIT (x,y=66, 13) 65 13}
        {LOYAL_UNIT 4 "Dwarvish Lord" 66 13 }
        {MOVE_UNIT (x,y=66, 13) 65 14}
        {LOYAL_UNIT 4 "Dwarvish Dragonguard" 66 13 }
        {MOVE_UNIT (x,y=66, 13) 66 14}
        {LOYAL_UNIT 4 "Dwarvish Lord" 66 13 }
        [store_unit]
            [filter]
                x,y=66,13
            [/filter]
        [/store_unit]
        {SPEAKING (id=$unit.id) "Surrender!"}
        [move_unit]
            [filter_location]
                x=66
                y=5
                radius=1
            [/filter_location]
            to_x=61
            to_y=11
        [/move_unit]
        {LOYAL_UNIT 4 "BfBH Dwarvish Berserker" 66 5 }
        {MOVE_UNIT (x,y=66, 5) 65 5}
        {LOYAL_UNIT 4 "BfBH Dwarvish Berserker" 66 5 }
        {MOVE_UNIT (x,y=66, 5) 65 6}
        {LOYAL_UNIT 4 "BfBH Dwarvish Berserker" 66 5 }
        {MOVE_UNIT (x,y=66, 5) 66 4}
        [capture_village]
            side=4
            x,y=66, 4
        [/capture_village]
        {LOYAL_UNIT 4 "BfBH Dwarvish Berserker" 66 5 }
        {MOVE_UNIT (x,y=66, 5) 66 6}
        {LOYAL_UNIT 4 "BfBH Dwarvish Berserker" 66 5 }
        [store_unit]
            [filter]
                x,y=66,5
            [/filter]
        [/store_unit]
        {SPEAKING (id=$unit.id) "Ha Cha Cha!"}
        [move_unit]
            [filter_location]
                x=60
                y=1
                radius=1
            [/filter_location]
            to_x=60
            to_y=5
        [/move_unit]
        {LOYAL_UNIT 4 "Dwarvish Sentinel" 59 1 }
        {MOVE_UNIT (x,y=59, 1) 59 2}
        {LOYAL_UNIT 4 "Dwarvish Sentinel" 60 1 }
        {MOVE_UNIT (x,y=60, 1) 60 2}
        {LOYAL_UNIT 4 "Dwarvish Sentinel" 61 1 }
        {MOVE_UNIT (x,y=61, 1) 61 2}
        {LOYAL_UNIT 4 "Dwarvish Arcanister" 60 1 }
        {LOYAL_UNIT 4 "Dwarvish Sentinel" 59 1 }
        {LOYAL_UNIT 4 "Dwarvish Sentinel" 61 1 }
        [store_unit]
            [filter]
                x,y=60, 1
            [/filter]
        [/store_unit]
        {SPEAKING (id=$unit.id) "You cannot escape!!!"}
        [delay]
            time=3000
        [/delay]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
#TODO in move events move units from their tile if its one of important speaker tiles, like general
#TODO stun, slow or smt units aroud wenrys, when he uses smoke bomb update the animation
#TODO remove events when not actuall instead of filtering if should be used using if
#TODO cavalery is the last issue
###WENRYS HEALS 2 LIVES next turn after killing rillon
###ADD LIGHT TO EDGE TORCHES AT UP MAP
#end_text=""
#end_text_duration=0
#last breath glerary doesnt work properly
#modify dwarven reinforcements after scenario 2 done
#goblin achieve lvl2 after some AMLAs (use role with zvetsujici AMLA[current_number+1] a pokud AMLA[(treba)5] tak zvysit level(zmenit xp jednotce, aby to odpovidalo))
#smoke screen/bomb into all six directions
###vlajecky stran
#TODO CUSTOM ENDLEVEL dialog
#BALANCE AMLA ONCE CAMPAIGN DONE viz TODO in amla
#modify DIFFICULTY
#jeskyne pochodne lepsi obrazek mozna pozmenit barvu svetla
#dat custom portraity
#global variable
#premalovat jeskini z hor MOZNA
#druhy scenar nektere jednotky se muzou pohnout poze na hrad/vesnici popisek co je to za pevnost trpaslik bude v cele, musis zabit sefa abys ziskal klice
#The rise of wesnoth images story
#grnk 1.14 pohyb z mimo mapy jako posledni zvazit
#obrany ai trpaslici, bottleneck
#muze se hodit [unstore_unit], [put_to_recall_list]
#cave-in.ogg
# [ai]
# 		aggression=0.01
# 		caution=0.99
# 		grouping = defensive
# 		[goal]
#         		name=protect_location
#         		[criteria]
#            		 x,y=9,9
#         		[/criteria]
#         		protect_radius=5
#         		value=1
#     		[/goal]
# 	[/ai]
#micro ai naga
#naga a moraci rozhodnuti vice, nejaky druh karmy
#Ctrl + B rusi modre radky
### pozor na ifndef x ifdef
##    {DUSK}
#     {FIRST_WATCH}
#     {SECOND_WATCH}
#     {DAWN}
#     {MORNING}
#     {AFTERNOON}
#[store_side]
#             side=1
#         [/store_side] 
# [if]
#             [variable]
#                 name=side.gold
#                 less_than=73
#             [/variable]
#             [then]                                    funguje
#                 [modify_side]
#                     side=1
#                     gold=73
#                 [/modify_side]
#             [/then]
#         [/if]

#[message]
#             speaker=Galdrad
#             message= _ "That unit is about one kill (8 experience points) away from gaining a level! Do not let it die!"
#             [show_if]
#                 [variable]
#                     name=unit.experience
#                     greater_than=$($unit.max_experience - 8)
#                 [/variable]
#             [/show_if]
#         [/message]
#extra_recruit: a list of unit types which this unit can recruit in addition to the ones given by its [side]recruit= (only relevant for units with canrecruit=yes).
