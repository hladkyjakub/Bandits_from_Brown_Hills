#textdomain wesnoth-Bandits_from_Brown_Hills
[scenario]
    name= _ "Pursuit"
    id=02_Pursuit
    map_file="02_Pursuit.map"
    next_scenario=03_Deep_caves
    turns= -1
    experience_modifier=100
    {DEFAULT_MUSIC_PLAYLIST}
    {IMPLEMENT_AMLA_CUSTOM}
    {IMPLEMENT_CUSTOM_ADVANCE_TREE}
    {IMPLEMENT_LOAD_COUNTER}
    {IMPLEMENT_ABILITIES_CUSTOM}
    {IMPLEMENT_DWARVISH_CANNONER_ENEMY_ONLY}
    {IMPLEMENT_TITLES_FOR_CERTAIN_UNITS}
    {UNDERGROUND}
    {GLOBAL__DROPPABLE_SMOKEBOMBS smokebombs_wenrys}
    {GLOBAL__DROPPABLE_MINERAL_WATER merman_mineral_water}
    victory_when_enemies_defeated=no
    #  [story]
 #       [part] #TODO
 #           show_title=yes
 #           {BANDITS_BIGMAP_CLEAR}
#                        story= _ "###Thanks for testing, 
#contact me on Discord (mnau_mnau#2188), 
#or on Wesnoth forum (topic_id=57210) and tell me if you like it, what should be done better and what mistakes have i made, once again thanks for testing!###"
#        [/part]
#          [part]
#              show_title=yes
#              ##{BANDITS_BIGMAP_CLEAR}
#              story= _ "<span size='70000' font_family='Oldania ADF Std' >                    Narrator
#  You rush forward to get the traitor, folowed with your men.
#  MEOW
#  MEOW
#  And then you hear that heroic meow</span>"
#              #WORKS font_style='italic'
#              #DOESNT WORK font_stretch='ultracondensed'
#          [/part]
#      [/story]
    [side]
        side=1
        facing=se
        controller=human
        color=green
        team_name=bandits
        side_name=_"Bandits"
        user_team_name= _ "Bandits"
        recruit=Thug, Footpad, Poacher
        {FLAG_VARIANT6 ragged}
        persistent=yes
        save_id=bandits
        gold=0
        shroud=yes
        defeat_condition=never
        #bandits(player)
    [/side]
    [side]
        side=2
        controller=ai
        color=blue
        team_name=enemy
        side_name=_"Humans"
        user_team_name= _ "Humans"
        recruit=Horseman, Cavalryman
        {FLAG_VARIANT loyalist}
        gold=999999
        [ai]
            aggression=0.99
            caution=0.01
        [/ai]
        #humans
    [/side]
    [side]
        side=3
        controller=ai
        color=green
        team_name=enemy
        side_name=_"Wenrys"
        user_team_name= _ "Wenrys"
        {FLAG_VARIANT6 ragged}
        gold=-999999
        #Wenrys
    [/side]
    [side]
        side=4
        controller=ai
        color=purple
        team_name=enemy
        side_name=Dwarves
        user_team_name= _ "Dwarves"
        {FLAG_VARIANT knalgan}
        {GOLD 20 30 40}
        income=-3
        recruit=Dwarvish Fighter, Dwarvish Guardsman, Dwarvish Thunderer
        [ai]
            id="town_defenders"
            [avoid]
                terrain=Uu*^*,Uh*^*,S*^*,W*^*,Ur^Es,Ds^*
            [/avoid]
            aggression=0.40
            caution=0.60
        [/ai]
        #Defenders, second attackers
    [/side]
    [side]
        side=5
        controller=ai
        color=teal
        team_name=enemy
        side_name=Dwarves
        user_team_name= _ "Dwarves"
        {FLAG_VARIANT knalgan}
        gold=999999
        recruit=Dwarvish Fighter, Dwarvish Guardsman, Dwarvish Thunderer, Dwarvish Scout
        [ai]
            aggression=0.65
            caution=0.35
        [/ai]
        #first attackers
    [/side]
    [side]
        side=6
        controller=ai
        color=white
        team_name=enemy
        side_name=_"Dwarves"
        user_team_name= _ "Dwarves"
        {FLAG_VARIANT knalgan}
        recruit=BfBH Dwarvish Berserker
        gold=999999
        [ai]
            aggression=0.99
            caution=0.01
        [/ai]
        #Last attackers, berserker clan
    [/side]
    [side]
        side=7
        controller=ai
        color=orange
        team_name=nagas
        side_name=_"Nagas"
        user_team_name= _ "Nagas"
        {FLAG_VARIANT6 ragged}
        type=Naga Warrior
        name= _ "Saxrireii Swift"
        gender=female
        facing=sw
        id=saxrireii
        income=-20
        experience={ON_DIFFICULTY 20 17 14}
        [modifications]
            {TRAIT_QUICK}
            {TRAIT_STRONG}
        [/modifications]
        [variables]
            title_gained=yes
        [/variables]
        recruit=Naga Fighter, Naga Dirkfang
        #Nagas/Mermans
    [/side]
    [side]
        side=8
        controller=ai
        color=black
        team_name=wild
        side_name=_"Wild"
        user_team_name= _ "Wild"
        {FLAG_VARIANT6 ragged}
        #Spiders
    [/side]
    [side]
        side=9
        controller=ai
        color=brown
        team_name=wild
        side_name=_"Wild"
        user_team_name= _ "Wild"
        {FLAG_VARIANT6 ragged}
        #Goblins, wolves
    [/side]
    [side]
        side=10
        controller=ai
        color=black
        team_name=wild
        side_name=_"Wild"
        user_team_name= _ "Wild"
        {FLAG_VARIANT6 ragged}
        #Bats
    [/side]
    [event]
        name=unit placed
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [object]
            silent=yes
            id=unwalkable_vision_costs_2
            take_only_once=no
            [filter]
                x,y=$x1,$y1
                [not]
                    [filter_wml]
                        [modifications]
                            [object]
                                id="unwalkable_vision_costs_2"
                            [/object]
                        [/modifications]
                    [/filter_wml]
                [/not]
            [/filter]
            [effect]
                apply_to=vision_costs
                replace=yes
                [vision_costs]
                    unwalkable=2
                [/vision_costs]
            [/effect]
        [/object]
    [/event]
    [event]
        name=prestart
        {IMPLEMENT_DWARVEN_MAGIC_ITEM_DROPPABLE}
        {VARIABLE citadel_objective_show false}
        {VARIABLE retreting_objective_note_show false}
        {VARIABLE last_turn_when_spider_was_spanwned 0 }
        {VARIABLE_OP turns_until_next_spider_spawn rand "{ON_DIFFICULTY 6 5 4}..{ON_DIFFICULTY 8 7 6}"}
        {VARIABLE last_turn_when_bat_was_spanwned 0 }
        {VARIABLE_OP turns_until_next_bat_spawn rand "{ON_DIFFICULTY 5 4 3}..{ON_DIFFICULTY 7 6 5}"}
        {VARIABLE last_turn_when_goblins_was_spanwned 0 }
        {VARIABLE_OP turns_until_next_goblins_spawn rand "{ON_DIFFICULTY 5 4 3}..{ON_DIFFICULTY 7 6 5}"}
        {VARIABLE wenrys_objective_description "Kill the traitor" }
        {VARIABLE wenrys_objective_show 1 }
        [set_variable]
            name=side_2_low_spawn_xp_units
            value=Cavalryman, Horseman
        [/set_variable]
        {PLACE_TORCHES 26,29,33,34,34,39,37,30,25,27,30,33,37,30,35,40,41,40,38,42,41,45,45,37,38,44,47,40,42 12,10,9,17,11,10,12,14,16,20,21,19,20,18,14,11,13,14,16,15,19,20,16,23,25,26,27,26,21}
        [objectives]
            side=1
            [objective]
                description= _ "$|wenrys_objective_description|"
                condition=win
                [show_if]
                    [variable]
                        name=wenrys_objective_show
                        equals=1
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "$|citadel_objective_description|"
                condition=win
                [show_if]
                    [variable]
                        name=citadel_objective_show
                        equals=true
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Death of Jareth"
                condition=lose
            [/objective]
            [gold_carryover]
                bonus=no
                carryover_percentage=40
            [/gold_carryover]
            [note]
               description= _ "You should hurry, reinforcements are on their way."
            [/note]
            [note]
                description= _ "Your men lose faith for fighting, once you'll retreat
(They'll be killed or sold as slaves)"
                [show_if]
                    [variable]
                        name=retreting_objective_note_show
                        equals=true
                    [/variable]
                [/show_if]
             [/note]
        [/objectives]
        ### have to do it this way becouse persistent and save_id doesnt work for some reason ### hmm
        [foreach]
            array=human_loyal_units
            [do]
                {VARIABLE human_loyal_units[$i].x 0}
                {VARIABLE human_loyal_units[$i].y 0}
                [unstore_unit]
                    variable=human_loyal_units[$i]
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        [modify_unit]
            [filter]
                x,y=recall,recall
                side=2
            [/filter]
            attacks_left=$this_unit.max_attacks
            moves=$this_unit.max_moves
            hitpoints=$this_unit.max_hitpoints
            [status]
                stunned=no
                poisoned=no
                slowed=no
                uncovered=no
                guardian=no
            [/status]
        [/modify_unit]
        {CLEAR_VARIABLE human_loyal_units}
        [micro_ai]
            side=2
            ai_type=fast_ai
            action=add
        [/micro_ai]
        [micro_ai]
            side=5
            ai_type=fast_ai
            action=add
        [/micro_ai]
        [micro_ai]
            side=6
            ai_type=fast_ai
            action=add
        [/micro_ai]
        [unit]
            type=$second_dwarven_leader_type
            name= _ "Timthasbor $second_dwarven_leader_title"
            side=4
            x,y=43,17
            facing=sw
            id=dwarven_citadel_leader
            experience={ON_DIFFICULTY 30 41 52}
            canrecruit=yes
            [variables]
                title_gained=yes
            [/variables]
        [/unit]
        [switch]
            variable=dwarven_magic_item
            [case]
                value="Boots of speed"
                [modify_unit]
                    [filter]
                        id=dwarven_citadel_leader
                    [/filter]
                    {TRAIT_HEALTHY}
                    {TRAIT_RESILIENT}
                    [trait]
                        id=boots_of_speed
                        name=boots of speed
                        description=""
                        [effect]
                            apply_to=movement
                            increase=2
                        [/effect]
                        [effect]
                            apply_to=hitpoints
                            increase_total=-10%
                        [/effect]
                    [/trait]
                [/modify_unit]
            [/case]
            [case]
                value="Breastplate of the mighty"
                [modify_unit]
                    [filter]
                        id=dwarven_citadel_leader
                    [/filter]
                    {TRAIT_RESILIENT}
                    {TRAIT_QUICK}
                    [trait]
                        id=breastplate_of_the_mighty
                        name=breastplate of the mighty
                        description=_"<span color='#0f0'>+20%</span> ranged physical resistance"
                        [effect]
                            apply_to=hitpoints
                            increase_total=4
                        [/effect]
                        [effect]
                            apply_to=hitpoints
                            times=per level
                            increase_total=1
                        [/effect]
                        [effect]
                            apply_to=new_ability
                            [abilities]
                                [resistance]
                                    id=breastplate_of_the_mighty_ability
                                    affect_self=yes
                                    add=20
                                    max_value=100
                                    apply_to=blade,pierce,impact
                                    [filter_second_weapon]
                                        range=ranged
                                    [/filter_second_weapon]
                                [/resistance]
                            [/abilities]
                        [/effect]
                    [/trait]
                [/modify_unit]
            [/case]
            [case]
                value="Diadem of intelligence"
                [modify_unit]
                    [filter]
                        id=dwarven_citadel_leader
                    [/filter]
                    {TRAIT_STRONG}
                    {TRAIT_HEALTHY}
                    [trait]
                        id=diadem_of_intelligence
                        name=diadem of intelligence
                        description=""
                        [effect]
                            apply_to=max_experience
                            increase=-40%
                        [/effect]
                        [effect]
                            apply_to=experience
                            increase=-40%
                        [/effect]
                    [/trait]
                [/modify_unit]
            [/case]
            [case]
                value="Ring of strengt"
                [modify_unit]
                    [filter]
                        id=dwarven_citadel_leader
                    [/filter]
                    {TRAIT_INTELLIGENT}
                    {TRAIT_STRONG}
                    [trait]
                        id=ring_of_strengt
                        name=ring of strengt
                        description=""
                        [effect]
                            apply_to=attack
                            range=melee
                            increase_damage=2
                        [/effect]
                        [effect]
                            apply_to=hitpoints
                            increase_total=2
                            increase=2
                        [/effect]
                    [/trait]
                [/modify_unit]
            [/case]
            [case]
                value="Huntsmans hat"
                [if]
                    [variable]
                        name=second_dwarven_leader_type
                        equals="Dwarvish Pathfinder"
                    [/variable]
                    [then]
                        [modify_unit]
                            [filter]
                                id=dwarven_citadel_leader
                            [/filter]
                            {TRAIT_RESILIENT}
                            {TRAIT_STRONG}
                            [trait]
                                id=huntsmans_hat
                                name=huntsmans hat
                                description=""
                                [effect]
                                    apply_to=attack
                                    range=ranged
                                    increase_damage=2
                                [/effect]
                            [/trait]
                        [/modify_unit]
                    [/then]
                    [else]
                        [modify_unit]
                            [filter]
                                id=dwarven_citadel_leader
                            [/filter]
                            {TRAIT_HEALTHY}
                            {TRAIT_QUICK}
                            [trait]
                                id=huntsmans_hat
                                name=huntsmans hat
                                description=""
                                [effect]
                                    apply_to=attack
                                    range=ranged
                                    increase_damage=6
                                [/effect]
                            [/trait]
                        [/modify_unit]
                    [/else]
                [/if]
            [/case]
            [case]
                value="Ankh"
                [modify_unit]
                    [filter]
                        id=dwarven_citadel_leader
                    [/filter]
                    {TRAIT_RESILIENT}
                    {TRAIT_QUICK}
                    [trait]
                        id=ankh
                        name=ankh
                        description=_"Always rest heals"
                        [effect]
                            apply_to="healthy"
                        [/effect]
                        [effect]
                            apply_to=hitpoints
                            times=per level
                            increase_total=2
                            increase=2
                        [/effect]
                    [/trait]
                [/modify_unit]
            [/case]
        [/switch]
        [unstore_unit]
            variable=wenrys_stored
            x,y=1,33
        [/unstore_unit]
        [heal_unit]
            id=wenrys
            amount=full
        [/heal_unit]
        [capture_village]
            side=4
            x=36
            y=16
            radius=10
        [/capture_village]
        [capture_village]
            side=7
            x=44
            y=3
            radius=7
        [/capture_village]
        [item]
            x, y=29,33
            image="scenery/nest-empty.png"
        [/item]
        [item]
            x, y=28,32
            image="scenery/nest-one.png"
        [/item]
        [item]
            x, y=28,33
            image="scenery/nest-three.png"
        [/item]
        [item]
            x, y=29,32
            image="scenery/nest-full.png"
        [/item]
        [item]
            x=34
            y=12
            image="units/orcs/assassin.png~RC(magenta>black)"
        [/item]
        [item]
            x=34
            y=12
            image="items/cage.png"
        [/item]
        [item]
            x=40
            y=10
            image="units/saurians/skirmisher/skirmisher.png~RC(magenta>black)"
        [/item]
        [item]
            x=40
            y=10
            image="items/cage.png"
        [/item]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=42,14
            id=dwarven_citadel_guard_1
            experience=7
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=38,15
            id=dwarven_citadel_guard_2
            experience=25
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_HEALTHY}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=39,18
            id=dwarven_citadel_guard_3
            experience=29
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=42,19
            id=dwarven_citadel_guard_4
            experience=17
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
                {TRAIT_HEALTHY}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=44,19
            id=dwarven_citadel_guard_5
            experience=22
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=44,17
            id=dwarven_citadel_guard_6
            experience=24
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
                {TRAIT_HEALTHY}
            [/modifications]
        [/unit]
        [modify_unit]
            [filter]
                x,y=42, 14,38, 15,39, 18,42, 19,44, 19,44, 17
            [/filter]
            [trait]
                name=_"trained"
                id=trained
                description=_"Unit hardened by intense training."
                [effect]
                    apply_to=hitpoints
                    increase_total={ON_DIFFICULTY 2 5 8}
                    heal_full=yes
                [/effect]
            [/trait]
        [/modify_unit]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            ca_id=dwarven_guard_micro_ai_1
            [filter]
                x,y=44, 17
            [/filter]
            [filter_location]
                x,y=44, 17
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            ca_id=dwarven_guard_micro_ai_2
            [filter]
                x,y=42, 14
            [/filter]
            [filter_location]
                x,y=42, 14
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            ca_id=dwarven_guard_micro_ai_3
            [filter]
                x,y=38, 15
            [/filter]
            [filter_location]
                x,y=38, 15
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            ca_id=dwarven_guard_micro_ai_4
            [filter]
                x,y=39, 18
            [/filter]
            [filter_location]
                x,y=39, 18
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            ca_id=dwarven_guard_micro_ai_5
            [filter]
                x,y=42, 19
            [/filter]
            [filter_location]
                x,y=42, 19
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            ca_id=dwarven_guard_micro_ai_6
            [filter]
                x,y=44, 19
            [/filter]
            [filter_location]
                x,y=44, 19
            [/filter_location]
        [/micro_ai]
        {GENERIC_UNIT 4 "Dwarvish Guardsman" 30 22}
        {GENERIC_UNIT 4 "Dwarvish Thunderer" 33 22}
       # {GENERIC_UNIT 4 "Dwarvish Guardsman" 32 15}
       # {GENERIC_UNIT 4 "Dwarvish Scout" 32 15}
        [unit]
            type="BfBH Dread Bat"
            side=10
            x,y=33,33
            id=big_bat
            experience=58
            [modifications]
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        [modify_unit]
            [filter]
                id=big_bat
            [/filter]
            [trait]
                name=_"nest guardian"
                id=nest_guardian
                description=_"Biggest of biggest."
                [effect]
                    apply_to=ellipse
                    ellipse="misc/ellipse-hero"
                [/effect]
                [effect]
                    apply_to=hitpoints
                    increase_total={ON_DIFFICULTY 3 7 11}
                    heal_full=yes
                [/effect]
                [effect]
                    apply_to=attack
                    increase_damage=1
                [/effect]
            [/trait]
        [/modify_unit]
        [micro_ai]
            side=10
            ai_type=return_guardian
            action=add
            id=big_bat
            return_x,return_y=33,33
        [/micro_ai]
        [unit]
            type="Giant Spider"
            side=8
            x,y=29,33
            id=big_spider
            experience=49
            [modifications]
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        [modify_unit]
            [filter]
                id=big_spider
            [/filter]
            [trait]
                name=_"nest guardian"
                id=nest_guardian
                description=_"Biggest of biggest."
                [effect]
                    apply_to=ellipse
                    ellipse="misc/ellipse-hero"
                [/effect]
                [effect]
                    apply_to=hitpoints
                    increase_total={ON_DIFFICULTY 6 9 12}
                    heal_full=yes
                [/effect]
                [effect]
                    apply_to=attack
                    range=melee
                    increase_damage=3
                [/effect]
                [effect]
                    apply_to=attack
                    range=ranged
                    increase_attacks=1
                [/effect]
            [/trait]
        [/modify_unit]
        [micro_ai]
            side=8
            ai_type=return_guardian
            action=add
            id=big_spider
            return_x,return_y=29,33
        [/micro_ai]
        [unit]
            type="Goblin Pillager"
            name=_"Progi the Pillager"
            side=9
            x,y=48,27
            id=progi
            experience=7
            [modifications]
                {TRAIT_INTELLIGENT}
                {TRAIT_STRONG}
            [/modifications]
            [variables]
                title_gained=yes
            [/variables]
        [/unit]
        [modify_unit]
            [filter]
                id=progi
            [/filter]
            [trait]
                id=tough
                name=_"tough"
                description=_"Only way to survive as a goblin and get to a leader position."
                [effect]
                    apply_to=ellipse
                    ellipse="misc/ellipse-hero"
                [/effect]
                [effect]
                    apply_to=hitpoints
                    increase_total={ON_DIFFICULTY 3 5 7}
                    heal_full=yes
                [/effect]
                [effect]
                    apply_to=attack
                    name=fangs
                    increase_attacks=1
                    increase_damage=1
                [/effect]
                [effect]
                    apply_to=attack
                    name=torch
                    increase_damage=2
                [/effect]
                [effect]
                    apply_to=attack
                    range=ranged
                    increase_attacks=1
                    increase_damage=-1
                [/effect]
            [/trait]
        [/modify_unit]
        [micro_ai]
            side=9
            ai_type=lurkers
            action=add
            [filter]
                id=progi
            [/filter]
            [filter_location]
                x,y=48,27
            [/filter_location]
            [filter_location_wander]
                x,y=48,27
            [/filter_location_wander]
        [/micro_ai]
        [event]
            name=unit placed
            first_time_only=no
            id=side_7_starting_xp
            [filter]
                side=7
            [/filter]
            {VARIABLE_OP units_experience rand "2..{ON_DIFFICULTY 13 15 17}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        {GENERIC_UNIT 7 "Naga Fighter" 31 7}
        {GENERIC_UNIT 7 "Naga Dirkfang" 31 6}
        {GENERIC_UNIT 7 "Naga Fighter" 32 6}
        [remove_event]
            id=side_7_starting_xp
        [/remove_event]
        [set_variable]
            name=friendly_sides
            value=1,7
        [/set_variable]
    [/event]
    [event]
        name=start
        [scroll_to_unit]
            id=wenrys
            immediate=yes
        [/scroll_to_unit]
        [remove_shroud]
            side=1
            x=2,3,6,8,11
            y=33,32,31,31,31
            radius=2
        [/remove_shroud]
        {MOVE_UNIT (id=wenrys) 43 13}
        [capture_village]
            side=3
            x,y=43,13
        [/capture_village]
        [micro_ai]
            side=3
            ai_type=lurkers
            action=add
            [filter]
                id=wenrys
            [/filter]
            [filter_location]
                x,y=43,13
            [/filter_location]
        [/micro_ai]
        [recall]
            id=jareth
            x,y=1,33
        [/recall]
        [redraw]
            side=1
        [/redraw]
        [clear_variable]
            name=jareth_stored
        [/clear_variable]
        [heal_unit]
            id=jareth
            amount=full
        [/heal_unit]
        {SPEAKING (id=jareth) "Get him!"}
        [move_unit]
            id=jareth
            to_x=10
            to_y=31
            clear_shroud=yes
        [/move_unit]
        {UNIVERSAL_RECALL 1 1 34 "Fugitive, Outlaw, Footpad" Footpad {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 10 31}
        {UNIVERSAL_RECALL 1 1 34 "Fugitive, Outlaw, Footpad" Footpad {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 10 31}
        {UNIVERSAL_RECALL 1 1 34 "Huntsman, Ranger, Trapper, Poacher" Poacher {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 10 31}
        {UNIVERSAL_RECALL 1 1 34 "Huntsman, Ranger, Trapper, Poacher" Poacher {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 10 31}
        {UNIVERSAL_RECALL 1 1 34 "Highwayman, Bandit, Thug" Thug {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 10 31}
        {UNIVERSAL_RECALL 1 1 34 "Highwayman, Bandit, Thug" Thug {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 10 31}
        {UNIVERSAL_RECALL 1 1 34 "Fugitive, Outlaw, Footpad" Footpad {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 12 30}
        {UNIVERSAL_RECALL 1 1 34 "Highwayman, Bandit, Thug" Thug {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 12 31}
        {UNIVERSAL_RECALL 1 1 34 "Huntsman, Ranger, Trapper, Poacher" Poacher {ON_DIFFICULTY 6 7 8}}
        {MOVE_UNIT (x,y=1,34) 13 31}
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            [filter]
                id=dwarven_citadel_leader
            [/filter]
            [filter_location]
                terrain=K*^*
            [/filter_location]
        [/micro_ai]
        [event]
            name=sighted
            [filter]
                id=wenrys
            [/filter]
            [filter_second]
                side=1
            [/filter_second]
            {SPEAKING (x,y=$x2, $y2) "You have last chance to surrender!"}
            {SPEAKING (id=wenrys) "..."}
            {SPEAKING (x,y=$x2, $y2) "I'll kill you, you filthy scum!"}
        [/event]
    [/event]
    [event]
        name=turn 1
        [unit]
            type="Dwarvish Fighter"
            side=4
            x,y=30,9
            hitpoints=15
            experience={ON_DIFFICULTY 15 18 21}
            resting=no
        [/unit]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=31,10
            experience={ON_DIFFICULTY 0 1 2}
            resting=no
        [/unit]
        [unit]
            type="Dwarvish Thunderer"
            side=4
            x,y=32,9
            hitpoints=29
            experience={ON_DIFFICULTY 3 4 5}
            resting=no
        [/unit]
        [unit]
            type="Dwarvish Thunderer"
            side=4
            x,y=28,10
            hitpoints=22
            experience={ON_DIFFICULTY 9 11 15}
            resting=no
        [/unit]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=36,10
            hitpoints=36
            experience={ON_DIFFICULTY 5 6 7}
            resting=no
        [/unit]
        [unit]
            type="Dwarvish Fighter"
            side=4
            x,y=37,10
            hitpoints=29
            experience={ON_DIFFICULTY 9 11 13}
            resting=no
        [/unit]
        [unit]
            type="Dwarvish Fighter"
            side=4
            x,y=34,22
            hitpoints=17
            experience={ON_DIFFICULTY 20 23 26}
            resting=no
        [/unit]
        [unit]
            type="Dwarvish Fighter"
            side=4
            x,y=32,22
            hitpoints=32
            experience={ON_DIFFICULTY 6 7 8}
            resting=no
        [/unit]
        [unit]
            type="Dwarvish Guardsman"
            side=4
            x,y=36,22
            hitpoints=41
            experience={ON_DIFFICULTY 10 13 18}
            resting=no
        [/unit]
        [unit]
            type="Naga Dirkfang"
            side=7
            x,y=36,9
            hitpoints=19
            experience={ON_DIFFICULTY 21 18 16}
            resting=no
        [/unit]
        [unit]
            type="Naga Fighter"
            side=7
            x,y=37,9
            hitpoints=29
            experience={ON_DIFFICULTY 16 13 10}
            resting=no
        [/unit]
        [unit]
            type="Naga Ophidian"
            side=7
            x,y=29,9
            experience={ON_DIFFICULTY 3 2 1}
            resting=no
        [/unit]
        [unit]
            type="Naga Dirkfang"
            side=7
            x,y=31,9
            hitpoints=13
            experience={ON_DIFFICULTY 28 27 26}
            resting=no
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
        [unit]
            type="Naga Fighter"
            side=7
            x,y=30,8
            hitpoints=31
            experience={ON_DIFFICULTY 14 12 10}
            resting=no
        [/unit]
        [unit]
            type="Naga Fighter"
            side=7
            x,y=28,9
            hitpoints=30
            experience={ON_DIFFICULTY 6 4 2}
            resting=no
        [/unit]
        [unit]
            type="Giant Spider"
            side=8
            x,y=29,26
            resting=no
            [modifications]
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type="Goblin Knight"
            side=9
            x,y=35,23
            hitpoints=45
            experience=3
            resting=no
            [modifications]
                {TRAIT_INTELLIGENT}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [unit]
            type="Wolf"
            side=9
            x,y=39,25
            experience=7
            resting=no
        [/unit]
        [unit]
            type="Goblin Spearman"
            side=9
            x,y=36,23
            hitpoints=9
            experience=11
            resting=no
        [/unit]
        [unit]
            type="Goblin Spearman"
            side=9
            x,y=37,24
            experience=3
            resting=no
        [/unit]
        [unit]
            type="Goblin Rouser"
            side=9
            x,y=35,24
            experience=33
            resting=no
        [/unit]
        [unit]
            type="BfBH Vampire Bat"
            side=10
            x,y=32,23
            hitpoints=14
            experience=5
            resting=no
            [modifications]
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        [unit]
            type="BfBH Vampire Bat"
            side=10
            x,y=34,23
            hitpoints=15
            experience=2
            resting=no
        [/unit]
        [unit]
            type="BfBH Blood Bat"
            side=10
            x,y=33,23
            hitpoints=20
            experience=46
            resting=no
        [/unit]
        [unit]
            type="BfBH Blood Bat"
            side=10
            x,y=32,25
            experience=17
            resting=no
        [/unit]
    [/event]
    [event]
        name=recruit
        [filter]
            side=1
        [/filter]
        first_time_only=no
        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 8 6 4}"}
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=recruit
        [filter]
            side=2
        [/filter]
        first_time_only=no
        [if]
            [variable]
                name=side_2_low_spawn_xp_units
                contains=$unit.type
            [/variable]
            [then]
                 {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 15 19 23}"}
            [/then]
            [else]
                 {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 37 42 47}"}
            [/else]
        [/if]
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=recruit
        [filter]
            side=4
        [/filter]
        first_time_only=no
        [if]
            [variable]
                name=unit.level
                equals=1
            [/variable]
            [then]
                 {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 11 15 19}"}
            [/then]
            [else]
                 {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 15 20 25}"}
            [/else]
        [/if]
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=recruit
        [filter]
            side=5
        [/filter]
        first_time_only=no
        [if]
            [variable]
                name=unit.level
                equals=1
            [/variable]
            [then]
                 {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 17 20 23}"}
            [/then]
            [else]
                 {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 30 35 40}"}
            [/else]
        [/if]
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=recruit
        [filter]
            side=6
        [/filter]
        first_time_only=no
        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 60 61 62}"}
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=recruit
        [filter]
            side=7
        [/filter]
        first_time_only=no
        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 23 20 17}"}
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=experience
                set=$units_experience
            [/effect]
        [/modify_unit]
    [/event]
    [event]
        name=side 8 turn refresh
        first_time_only=no
        [if]
            [variable]
                name=turn_number
                equals="$($last_turn_when_spider_was_spanwned + $turns_until_next_spider_spawn)"
            [/variable]
            [then]
                {VARIABLE last_turn_when_spider_was_spanwned $turn_number}
                {VARIABLE_OP turns_until_next_spider_spawn rand "{ON_DIFFICULTY 8 7 6}..{ON_DIFFICULTY 10 9 8}"}
                {RANDOM_AROUND_PLACEMENT 29 33}
                {VARIABLE_OP spider_trait rand (quick, resilient, intelligent, strong)}
                [unit]
                    type=Giant Spider
                    side=8
                    x,y=$adjecent_hexes[$i].x, $adjecent_hexes[$i].y
                    placement=map
                    passable=yes
                [/unit]
                [switch]
                    variable=spider_trait
                    [case]
                        value="quick"
                        [modify_unit]
                            [filter]
                                side=8
                                race=monster
                                [not]
                                    trait=quick, resilient, intelligent, strong
                                [/not]
                            [/filter]
                            {TRAIT_QUICK}
                        [/modify_unit]
                    [/case]
                    [case]
                        value="resilient"
                        [modify_unit]
                            [filter]
                                side=8
                                race=monster
                                [not]
                                    trait=quick, resilient, intelligent, strong
                                [/not]
                            [/filter]
                            {TRAIT_RESILIENT}
                            [effect]
                                apply_to=hitpoints
                                increase=7
                            [/effect]
                        [/modify_unit]
                    [/case]
                    [case]
                        value="intelligent"
                        [modify_unit]
                            [filter]
                                side=8
                                race=monster
                                [not]
                                    trait=quick, resilient, intelligent, strong
                                [/not]
                            [/filter]
                            {TRAIT_INTELLIGENT}
                        [/modify_unit]
                    [/case]
                    [case]
                        value="strong"
                        [modify_unit]
                            [filter]
                                side=8
                                race=monster
                                [not]
                                    trait=quick, resilient, intelligent, strong
                                [/not]
                            [/filter]
                            {TRAIT_STRONG}
                            [effect]
                                apply_to=hitpoints
                                increase=1
                            [/effect]
                        [/modify_unit]
                    [/case]
                [/switch]
                [clear_variable]
                    name=spider_trait
                [/clear_variable]
            [/then]
        [/if]
    [/event]
    [event]
        name=preload
        first_time_only=no
         [lua]
             code=<<
local _ = wesnoth.textdomain "wesnoth-Bandits_from_Brown_Hills" --Idk how to use it???
local f_side_playing = wesnoth.interface.game_display.side_playing
function wesnoth.interface.game_display.side_playing()
	local g = f_side_playing()
	if wesnoth.current.side == 1 then --add elseif for more variants
        g[1][2].tooltip="BB (Best Band)"
	else
        g[1][2].tooltip="Who cares?"
    end
	return g
end
local f_turn = wesnoth.interface.game_display.turn
function wesnoth.interface.game_display.turn()
	local g = f_turn()
	g[1][2].tooltip="Turn number\n\n        What does 'Turn number' mean?"
	return g
end
local f_gold = wesnoth.interface.game_display.gold
function wesnoth.interface.game_display.gold()
	local g = f_gold()
	if type(g[1][2].text) ~= "number" then
		num = g[1][2].text:gsub("<[^>]+>", "")
	else
		num = g[1][2].text
	end
	if num and tonumber(num) < 0 then
		g[1][2].tooltip="No B*tches?\n\n        I mean 'No Gold?'"
	else
		g[1][2].tooltip="<span color='#FFD700'>Gold\n\n        Sooo shiny...</span>"
	end
	return g
end
local f_villages = wesnoth.interface.game_display.villages
function wesnoth.interface.game_display.villages()
	local g = f_villages()
	if type(g[1][2].text) ~= "number" then
		str = g[1][2].text:gsub("<[^>]+>", "")
	else
		str = g[1][2].text
	end
	num = str:match(".-/(.*)")
	if tonumber(num) < 1 then
        g[1][2].tooltip="Tribute-Paying Settlements\n\n        None in sight"
    else
        num = str:match("(.-)/")
        if tonumber(num) < 1 then
            g[1][2].tooltip="Tribute-Paying Settlements\n\n        What about getting some?"
        else
            g[1][2].tooltip="Tribute-Paying Settlements\n\n        = even more <span color='#FFD700'>gold</span>"
        end
    end
	return g
end
local f_num_units = wesnoth.interface.game_display.num_units
function wesnoth.interface.game_display.num_units()
	local g = f_num_units()
	num = tonumber(g[1][2].text)
	if num == 1 then
		g[1][2].tooltip="I\n\n        ... don't like where this is going!"
	else
		g[1][2].tooltip="My men\n\n        Very loyal... in these caves"
	end
	return g
end
local f_upkeep = wesnoth.interface.game_display.upkeep
function wesnoth.interface.game_display.upkeep()
	local g = f_upkeep()
	if type(g[1][2].text) ~= "number" then
		str = g[1][2].text:gsub("<[^>]+>", "")
	else
		str = g[1][2].text
	end
	num = str:gsub("%b()", "")
	if tonumber(num) < 1 then
		g[1][2].tooltip="Upkeep\n\n        What are you talking about?"
	else
		g[1][2].tooltip="Hell\n\n        Why does everyone demand payment?"
	end
	return g
end
local f_income = wesnoth.interface.game_display.income
function wesnoth.interface.game_display.income()
	local g = f_income()
	if type(g[1][2].text) ~= "number" then
		num = g[1][2].text:gsub("<[^>]+>", "")
	else
		num = g[1][2].text
	end
	if tonumber(num) < 0 then
		g[1][2].tooltip="Income\n\n        Why it's negative?"
	else
		g[1][2].tooltip="<span weight='bold'>Stonks!</span>"
	end
	return g
end
local f_report_countdown = wesnoth.interface.game_display.report_countdown
function wesnoth.interface.game_display.report_countdown()
	local g = f_report_countdown()
	g[2][2].tooltip="Clock\n\n        Should get a working one..."--[2][2] has to be there, becouse it has image more element
	return g
end
local f_unit_name = wesnoth.interface.game_display.unit_name
function wesnoth.interface.game_display.unit_name()
	local g = f_unit_name()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.id == "jareth" then
            g[1][2].tooltip="That's me"
        elseif u.name == "" then
            g[1][2].tooltip="Nameless creature"
        else
            g[1][2].tooltip="You know what name means right?"
        end
    end
	return g
end
local f_unit_type = wesnoth.interface.game_display.unit_type
function wesnoth.interface.game_display.unit_type()
	local g = f_unit_type()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        g[1][2].tooltip="That's a lots of words\n\ntoo bad I'm not gonna read them"
    end
	return g
end
local f_unit_side = wesnoth.interface.game_display.unit_side
function wesnoth.interface.game_display.unit_side()
	local g = f_unit_side()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.side == 1 then
            g[1][2].tooltip="BB (Best Band)"
            g[2][2].tooltip="BB (Best Band)"
        else
            g[1][2].tooltip="Who cares?"
            g[2][2].tooltip="Who cares?"
        end
    end
	return g
end
local f_unit_xp = wesnoth.interface.game_display.unit_xp
function wesnoth.interface.game_display.unit_xp()
	local g = f_unit_xp()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.experience == 1 then
            g[1][2].tooltip="This unit has exactlly one experience."
        elseif u.experience == 69 then
            g[1][2].tooltip="Nice!"
        elseif u.experience > (u.max_experience * 0.8) then
            if u.side == 1 then
                g[1][2].tooltip="We're going brrr!"
            else
                g[1][2].tooltip="This unit is close to level-up... keep that in mind!"
            end
        else
            g[1][2].tooltip="You don't know what XP means!?"
        end
    end
	return g
end
local f_unit_alignment = wesnoth.interface.game_display.unit_alignment
function wesnoth.interface.game_display.unit_alignment()
	local g = f_unit_alignment()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.alignment == "neutral" then
            g[1][2].tooltip="Boring"
        elseif u.alignment == "chaotic" then
            g[1][2].tooltip="Cool guys!"
        elseif u.alignment == "lawful" then
            g[1][2].tooltip="Literally the most boring aligment ever"
        elseif u.alignment == "liminal" then
            g[1][2].tooltip="Now we're talking!"
        else
            g[1][2].tooltip="Oh, I've never seen such a unit before"
        end
    end
	return g
end
local f_unit_race = wesnoth.interface.game_display.unit_race
function wesnoth.interface.game_display.unit_race()
	local g = f_unit_race()
	if wesnoth.interface.get_displayed_unit() then
        local u = wesnoth.interface.get_displayed_unit()
        if u.race == "human" then
            g[1][2].tooltip="Superior race"
        elseif u.race == "dwarf" then
            g[1][2].tooltip="Digging holes"
        elseif u.race == "naga" then
            g[1][2].tooltip="Water sss's"
        elseif u.race == "merfolk" then
            g[1][2].tooltip="WaterMan"
        elseif u.race == "lizard" then
            g[1][2].tooltip="Sss's"
        elseif u.race == "orc" then
            g[1][2].tooltip="With muscles like boulders and brain like... slightly smaller boulder"
        elseif u.race == "monster" then
            g[1][2].tooltip="What the hell is that?"
        elseif u.race == "goblin" then
            g[1][2].tooltip="Small, sneaky, and always up to no good"
        elseif u.race == "bats" then
            g[1][2].tooltip="Flying furball of fangs"
        elseif u.race == "wolf" then
            g[1][2].tooltip="Degenerated dog(cats are better)"
        else
            g[1][2].tooltip="???"
        end
    end
	return g
end
local f_terrain_info = wesnoth.interface.game_display.terrain_info
function wesnoth.interface.game_display.terrain_info()
	local g = f_terrain_info()
	if wesnoth.interface.get_selected_hex() and g ~= {} and wesnoth.interface.get_hovered_hex() == nil then
        local i = 1
        while g[i] and g[i][2] and g[i][2].tooltip ~= nil do
            if g[i][2].tooltip == "Castle" then
                g[i][2].tooltip="Fort"
            elseif g[i][2].tooltip == "Cave" then
                g[i][2].tooltip="Cavern"
            elseif g[i][2].tooltip == "Coastal Reef" then
                g[i][2].tooltip="Reef"
            elseif g[i][2].tooltip == "Deep Water" then
                g[i][2].tooltip="Depths"
            elseif g[i][2].tooltip == "Flat" then
                g[i][2].tooltip="Walkable"
            elseif g[i][2].tooltip == "Forest" then
                g[i][2].tooltip="Woods"
            elseif g[i][2].tooltip == "Frozen" then
                g[i][2].tooltip="Icy"
            elseif g[i][2].tooltip == "Fungus" then
                g[i][2].tooltip="Mushroom"
            elseif g[i][2].tooltip == "Hills" then
                g[i][2].tooltip="Knolls"
            elseif g[i][2].tooltip == "Impassable" then
                g[i][2].tooltip="How the hell have you got there!??"
            elseif g[i][2].tooltip == "Mountains" then
                g[i][2].tooltip="Massifs"
            elseif g[i][2].tooltip == "Sand" then
                g[i][2].tooltip="Beach"
            elseif g[i][2].tooltip == "Shallow Water" then
                g[i][2].tooltip="Shallows"
            elseif g[i][2].tooltip == "Swamp" then
                g[i][2].tooltip="Bog"
            elseif g[i][2].tooltip == "Unwalkable" then
                g[i][2].tooltip="Unwalkable\n\n        I mean you can try to jump into it"
            elseif g[i][2].tooltip == "Village" then
                g[i][2].tooltip="House"
            else
                g[i][2].tooltip="???"
            end
            i = i + 1
        end
    end
	return g
end
             >>
         [/lua]
        ### TODO feel free to expand this
    [/event]
    [event]
        name=side 7 turn 
        first_time_only=no
        [filter_condition]
            [lua]
                code=<< return (wml.variables["turn_number"] % 5 == 0) >>
            [/lua]
        [/filter_condition]
        [gold]
            side=7
            amount=140
        [/gold]
    [/event]
    [event]
        name=side 9 turn refresh
        first_time_only=no
        [filter_condition]
            [have_unit]
                id=progi
            [/have_unit]
        [/filter_condition]
        [if]
            [variable]
                name=turn_number
                equals="$($last_turn_when_goblins_was_spanwned + $turns_until_next_goblins_spawn)"
            [/variable]
            [then]
                {VARIABLE last_turn_when_goblins_was_spanwned $turn_number}
                {VARIABLE_OP turns_until_next_goblins_spawn rand "{ON_DIFFICULTY 7 6 5}..{ON_DIFFICULTY 9 8 7}"}
                {VARIABLE_OP goblin_squad_type rand (Wolf Riders, Skilled Soliders, Goblins With Leaders, Goblins With Leaders)}
                #[store_reachable_locations]
                    #[filter]
                        #id=progi
                    #[/filter]
                    #variable=goblins_spawn_locations
                #[/store_reachable_locations]
                [switch]
                    variable=goblin_squad_type
                    [case]
                        value="Wolf Riders"
                        {VARIABLE number_of_goblins_to_spawn 4}
                        [for]
                            variable=goblins_spawned
                            start=1
                            step=1
                            end=$number_of_goblins_to_spawn
                            [do]
                                {VARIABLE_OP goblin_type rand (Wolf Rider, Wolf Rider, Wolf Rider, Wolf, Wolf, Great Wolf)}
                                [if]
                                    [variable]
                                        name=goblin_type
                                        equals=Great Wolf
                                    [/variable]
                                    [then]
                                        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 6 7 8}"}
                                    [/then]
                                    [else]
                                        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 19 20 21}"}
                                    [/else]
                                [/if]
                                #[move_unit_fake]
                                    #type=$goblin_type
                                    #x=48,$adjecent_hexes[$i].x
                                    #y=27,$adjecent_hexes[$i].y
                                    #side=9
                                #[/move_unit_fake]
                                [unit]
                                    type="$goblin_type"
                                    side=9
                                    x,y=48,27  
                                    #$adjecent_hexes[$i].x, $adjecent_hexes[$i].y
                                    experience=$units_experience
                                    placement=map
                                    passable=yes
                                [/unit]
                            [/do]
                        [/for]
                    [/case]
                    [case]
                        value="Skilled Soliders"
                        {VARIABLE number_of_goblins_to_spawn 5}
                        [for]
                            variable=goblins_spawned
                            start=1
                            step=1
                            end=$number_of_goblins_to_spawn
                            [do]
                                {VARIABLE_OP goblin_type rand (Goblin Impaler, Goblin Impaler, Goblin Impaler, Goblin Impaler, Goblin Spearman)}
                                [if]
                                    [variable]
                                        name=goblin_type
                                        equals=Goblin Spearman
                                    [/variable]
                                    [then]
                                        {VARIABLE_OP units_experience rand "{ON_DIFFICULTY 0 5 10}..17"}
                                    [/then]
                                    [else]
                                        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 10 12 14}"}
                                    [/else]
                                [/if]
                                #[move_unit_fake]
                                    #type=$goblin_type
                                    #x=48,$adjecent_hexes[$i].x
                                    #y=27,$adjecent_hexes[$i].y
                                    #side=9
                                #[/move_unit_fake]
                                [unit]
                                    type="$goblin_type"
                                    side=9
                                    x,y=48,27  #$adjecent_hexes[$i].x, $adjecent_hexes[$i].y
                                    experience=$units_experience
                                    placement=map
                                    passable=yes
                                [/unit]
                            [/do]
                        [/for]
                    [/case]
                    [case]
                        value="Goblins With Leaders"
                        {VARIABLE_OP number_of_goblins_to_spawn rand "5..{ON_DIFFICULTY 5 6 6}"}
                        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 20 21 22}"}
                        [unit]
                            type="Goblin Rouser"
                            side=9
                            x,y=48,27  #$adjecent_hexes[$i].x, $adjecent_hexes[$i].y
                            experience=$units_experience
                            placement=map
                            passable=yes
                        [/unit]
                        [for]
                            variable=goblins_spawned
                            start=1
                            step=1
                            end=$number_of_goblins_to_spawn
                            [do]
                                {VARIABLE_OP goblin_type rand (Goblin Spearman, Goblin Spearman, Goblin Spearman, Goblin Spearman, Goblin Spearman, Goblin Rouser)}
                                [if]
                                    [variable]
                                        name=goblin_type
                                        equals=Goblin Spearman
                                    [/variable]
                                    [then]
                                        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 1 2 3}"}
                                    [/then]
                                    [else]
                                        {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 5 7 9}"}
                                    [/else]
                                [/if]
                                #[move_unit_fake]
                                    #type=$goblin_type
                                    #x=48,$adjecent_hexes[$i].x
                                    #y=27,$adjecent_hexes[$i].y
                                    #side=9
                                #[/move_unit_fake]
                                [unit]
                                    type="$goblin_type"
                                    side=9
                                    x,y=48,27  #$adjecent_hexes[$i].x, $adjecent_hexes[$i].y
                                    experience=$units_experience
                                    placement=map
                                    passable=yes
                                [/unit]
                            [/do]
                        [/for]
                    [/case]
                [/switch]
            [/then]
        [/if]
    [/event]
    [event]
        name=side 10 turn refresh
        first_time_only=no
        [if]
            [variable]
                name=turn_number
                equals="$($last_turn_when_bat_was_spanwned + $turns_until_next_bat_spawn)"
            [/variable]
            [then]
                {VARIABLE last_turn_when_bat_was_spanwned $turn_number}
                {VARIABLE_OP turns_until_next_bat_spawn rand "{ON_DIFFICULTY 6 5 4}..{ON_DIFFICULTY 8 7 6}"}
                {VARIABLE_OP bat_number rand "3..{ON_DIFFICULTY 3 4 4}"}
                [for]
                    variable=bats_spawned
                    start=1
                    step=1
                    end=$bat_number
                    [do]
                        {RANDOM_AROUND_PLACEMENT 33 33}
                        {VARIABLE_OP bat_type rand (BfBH Dread Bat,BfBH Blood Bat,BfBH Blood Bat,BfBH Vampire Bat,BfBH Vampire Bat,BfBH Vampire Bat,BfBH Vampire Bat)}
                        [if]
                            [variable]
                                name=bat_type
                                equals=BfBH Vampire Bat
                            [/variable]
                            [then]
                                {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 12 14 16}"}
                            [/then]
                            [else]
                                {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 32 40 48}"}
                            [/else]
                        [/if]
                        [move_unit_fake]
                            type=$bat_type
                            x=33,$adjecent_hexes[$i].x
                            y=33,$adjecent_hexes[$i].y
                            side=10
                        [/move_unit_fake]
                        [unit]
                            type="$bat_type"
                            side=10
                            x,y=$adjecent_hexes[$i].x, $adjecent_hexes[$i].y
                            experience=$units_experience
                            placement=map
                            passable=yes
                        [/unit]
                    [/do]
                [/for]
            [/then]
        [/if]
    [/event]
    [event]
    #TODO find closest empty tile, then fake unit move
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=34,12
        [/filter]
        {SPEAKING (id=$unit.id) "There's an orc in this dwarven cage!"}
        {SPEAKING (id=jareth) "Dwarven enemy is our ally, free him."}
        {SPEAKING (id=$unit.id) "Here you go, friend!"}
        [remove_item]
            x,y=34,12
            image="units/orcs/assassin.png~RC(magenta>black)"
        [/remove_item]
        [sound]
            name=open-chest.wav
        [/sound]
        [unit]
            type=Orcish Assassin
            x,y=35,12
            name=Vrugdush
            unrenamable=yes
            id=friendly_assassin
            side=10
            passable=yes
            animate=no
            experience={ON_DIFFICULTY 4 2 0}
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
        {SPEAKING (id=friendly_assassin) "Finally out..."}
        {SPEAKING (id=friendly_assassin) "Who are you?"}
        {SPEAKING (x,y=34,12) "Oh, we're ... how to say it... group of freelancers."}
        [modify_unit]
            [filter]
                id=friendly_assassin
            [/filter]
            side=1
            {TRAIT_LOYAL}
         [/modify_unit]
         {SPEAKING (id=friendly_assassin) "I'll help you fight our way out from this hell!"}
    [/event]
    [event]
    #TODO find closest empty tile, then fake unit move
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=40,10
        [/filter]
        {SPEAKING (id=$unit.id) "There's a saurian in dwarven jail!"}
        {SPEAKING (id=jareth) "Let him go."}
        {SPEAKING (id=$unit.id) "You're free now!"}
        [remove_item]
            x,y=40,10
            image="units/saurians/skirmisher/skirmisher.png~RC(magenta>black)"
        [/remove_item]
        [sound]
            name=open-chest.wav
        [/sound]
        [unit]
            type=Saurian Skirmisher
            x,y=39,11
            name=Frizzle
            unrenamable=yes
            id=friendly_saurian
            side=10
            passable=yes
            animate=no
            experience={ON_DIFFICULTY 5 3 1}
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        {SPEAKING (id=friendly_saurian) "Freessdom!"}
        {SPEAKING (id=friendly_saurian) "Whoss are you?"}
        {SPEAKING (x,y=40,10) "Oh, we're ... how to say it... group free merchants."}
        [modify_unit]
            [filter]
                id=friendly_saurian
            [/filter]
            side=1
            {TRAIT_LOYAL}
         [/modify_unit]
         {SPEAKING (id=friendly_saurian) "I needss to get out, I'll helpss you to get outss!"}
    [/event]
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1,7
            [filter_location]
                x,y=43,17
                radius=1
            [/filter_location]
        [/filter]
        [if]
            [have_unit]
                id=dwarven_citadel_leader
            [/have_unit]
            [then]
                {SPEAKING (id=dwarven_citadel_leader) "GUARDS, FIGHT FOR ME, FIGHT FOR US, FIGHT FOR DWARVES!!!"}
                {SPEAKING (id=$unit.id) "You won't get up tomorrow!"}
            [/then]
            [else]
                {SPEAKING (id=$unit.id) "We've sieged the city citadel!"}
            [/else]
        [/if]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=delete
            ca_id=dwarven_guard_micro_ai_1
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=delete
            ca_id=dwarven_guard_micro_ai_2
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=delete
            ca_id=dwarven_guard_micro_ai_3
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=delete
            ca_id=dwarven_guard_micro_ai_4
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=delete
            ca_id=dwarven_guard_micro_ai_5
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=delete
            ca_id=dwarven_guard_micro_ai_6
        [/micro_ai]
    [/event]
    [event]
        name=side 2 turn 7 refresh
        {SPEAKING (
    [filter_location]
        x=4
        y=32
        radius=3
    [/filter_location]) 
    "Cavalry goes after us!"}
        [move_unit]
            [filter_location]
                x=4
                y=32
                radius=3
            [/filter_location]
            to_x=13
            to_y=31
        [/move_unit]
        [unstore_unit]
            variable=glerary_stored
            x,y=1,32
        [/unstore_unit]
        [heal_unit]
            [filter]
                id=glerary
            [/filter]
            restore_attacks=yes
            moves=full
        [/heal_unit]
        [modify_unit]
            [filter]
                id=glerary
            [/filter]
            canrecruit=yes
            [filter_recall]
                type=Paladin, Grand Knight, Cavalier, Lancer, Knight, Dragoon, Horseman, Cavalryman
            [/filter_recall]
        [/modify_unit]
        [remove_trait]
            id=glerary
            trait_id=loyal
        [/remove_trait]
        {SPEAKING (id=glerary) "Soldiers get those raides down!"}
        {SPEAKING (id=jareth) "Oh no cavalry is still going after us!"}
        {BUILD_CAMP_KEEP (id=glerary) 5 32}
        {UNIVERSAL_RECALL 2 1 32 "Paladin, Grand Knight, Cavalier, Lancer, Knight, Dragoon, Horseman, Cavalryman" Horseman {ON_DIFFICULTY 26 28 30}}
        {BUILD_CAMP (x,y=1, 32) 7 32}
        [micro_ai]
            side=2
            ca_id=cavalry_lurkers_micro_ai_1
            ai_type=lurkers
            action=add
            [filter]
                x,y=7,32
            [/filter]
            [filter_location]
                x,y=7,32
            [/filter_location]
        [/micro_ai]
        {UNIVERSAL_RECALL 2 1 32 "Paladin, Grand Knight, Cavalier, Lancer, Knight, Dragoon, Horseman, Cavalryman" Cavalryman {ON_DIFFICULTY 22 24 26}}
        {BUILD_CAMP (x,y=1, 32) 6 30}
        [micro_ai]
            side=2
            ca_id=cavalry_lurkers_micro_ai_2
            ai_type=lurkers
            action=add
            [filter]
                x,y=6,30
            [/filter]
            [filter_location]
                x,y=6,30
            [/filter_location]
        [/micro_ai]
        {UNIVERSAL_RECALL 2 1 32 "Paladin, Grand Knight, Cavalier, Lancer, Knight, Dragoon, Horseman, Cavalryman" Horseman {ON_DIFFICULTY 6 8 11}}
        {BUILD_CAMP (x,y=1, 32) 4 31}
        {BUILD_CAMP (x,y=4, 31) 5 31}
        {BUILD_TORCH_UP (x,y=5, 31) 5 31 (4-6,5) (30,31)}
        {BUILD_TENT_VILLAGE (x,y=5, 31) 4 30}
        [capture_village]
            side=2
            x,y=4,30
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
        {UNIVERSAL_RECALL 2 1 32 "Paladin, Grand Knight, Cavalier, Lancer, Knight, Dragoon, Horseman, Cavalryman" Cavalryman {ON_DIFFICULTY 10 12 14}}
        {BUILD_CAMP (x,y=1, 32) 4 32}
        {BUILD_TENT_VILLAGE (x,y=4, 32) 6 32}
        [capture_village]
            side=2
            x,y=6,32
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
    [/event]
    [event]
        name=side 2 turn 13 refresh
        {SPEAKING ([filter_location]
        x=1
        y=34
    [/filter_location]) "Marshal Sir Meory!!!"}
        [move_unit]
            [filter_location]
                x=4
                y=34
            [/filter_location]
            to_x=11
            to_y=31
        [/move_unit]
        [unstore_unit]
            variable=meory_stored
            x,y=1,34
        [/unstore_unit]
        [heal_unit]
            [filter]
                id=meory
            [/filter]
            restore_attacks=yes
            moves=full
        [/heal_unit]
        [modify_unit]
            [filter]
                id=glerary
            [/filter]
            canrecruit=no
            {TRAIT_LOYAL_HERO}
        [/modify_unit]
        [modify_unit]
            [filter]
                id=meory
            [/filter]
            [filter_recall]
                type=Longbowman, Master Bowman, Pikeman, Halberdier, Swordsman, Royal Guard, Javelineer, General, Grand Marshal
            [/filter_recall]
        [/modify_unit]
        [if]
            [have_unit]
                id=glerary
            [/have_unit]
            [then]
                {SPEAKING (id=meory) "Sir Glerary, I'm counting on you destroying these bandits."}
                {SPEAKING (id=glerary) "Sir, yes, Sir, I'll kill their leader myself"}
            [/then]
            [else]
                {SPEAKING (id=meory) "These bandits gonna pay for Sir's Glerary's death!"}
            [/else]
        [/if]
        {SPEAKING (side=1
        [filter_location]
            x=4
            y=32
            radius=3
        [/filter_location]) "We got to go! Quick!"}
        [micro_ai]
            side=2
            ca_id=cavalry_lurkers_micro_ai_2
            ai_type=lurkers
            action=delete
        [/micro_ai]
        [micro_ai]
            side=2
            ca_id=cavalry_lurkers_micro_ai_1
            ai_type=lurkers
            action=delete
        [/micro_ai]
        [move_unit]
            [filter_location]
                x=4
                y=32
                radius=3
            [/filter_location]
            [not]
                id=meory
            [/not]
            to_x=14
            to_y=30
        [/move_unit]
        [modify_side]
            side=2
            recruit=Longbowman, Swordsman, Pikeman
            gold=999999
        [/modify_side]
        {MOVE_UNIT (id=meory) 5 32}
        {UNIVERSAL_RECALL 2 1 34 "Grand Marshal, General" General {ON_DIFFICULTY 50 55 60}}
        {MOVE_UNIT (x,y=1, 34) 6 30}
        {UNIVERSAL_RECALL 2 1 34 "Grand Marshal, General" General {ON_DIFFICULTY 50 55 60}}
        {MOVE_UNIT (x,y=1, 34) 7 32}
        {UNIVERSAL_RECALL 2 1 34 "Halberdier, Pikeman" Pikeman {ON_DIFFICULTY 30 40 50}}
        {BUILD_CAMP (x,y=1, 34) 3 33}
        {UNIVERSAL_RECALL 2 1 34 "Master Bowman, Longbowman" Longbowman {ON_DIFFICULTY 30 40 50}}
        {BUILD_TENT_VILLAGE (x,y=1, 34) 2 31}
        [capture_village]
            side=2
            x,y=2,31
        [/capture_village]
        {UNIVERSAL_RECALL 2 1 34 "Royal Guard, Swordsman" Swordsman {ON_DIFFICULTY 30 40 50}}
        {BUILD_TORCH_UP (x,y=1, 34) 5 34 (4-5,5) (33,34)}
        {BUILD_CAMP (x,y=3, 33) 3 32}
        {BUILD_TORCH_UP (x,y=2, 31) 2 31 (1-3,2) (31,30)}
        {BUILD_TENT_VILLAGE (x,y=5, 34) 6 31}
        [capture_village]
            side=2
            x,y=6,31
        [/capture_village]
        {UNIVERSAL_RECALL 2 1 34 "Javelineer" Javelineer {ON_DIFFICULTY 30 40 50}}
        {BUILD_TENT_VILLAGE (x,y=1, 34) 3 30}
        [capture_village]
            side=2
            x,y=3,30
        [/capture_village]
        {BUILD_CAMP (x,y=3, 32) 3 31}
        [micro_ai]
            side=2
            ai_type=lurkers
            action=add
            [filter]
                x,y=6,30
            [/filter]
            [filter_location]
                x,y=6,30
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=2
            ai_type=lurkers
            action=add
            [filter]
                x,y=7,32
            [/filter]
            [filter_location]
                x,y=7,32
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=2
            ai_type=lurkers
            action=add
            [filter]
                x,y=5,32
            [/filter]
            [filter_location]
                x,y=5,32
            [/filter_location]
        [/micro_ai]
    [/event]
    [event]
        name=side 5 turn 10 refresh
        {SPEAKING ([filter_location]
        x=4
        y=2
        radius=3
    [/filter_location]) "Reinforcements!"}
        [move_unit]
            [filter_location]
                x=4
                y=2
                radius=3
            [/filter_location]
            to_x=10
            to_y=5
        [/move_unit]
        [unit]
            type=Dwarvish Pathfinder
            side=5
            id=first_side_5_unit
            experience={ON_DIFFICULTY 24 32 39}
            [modifications]
                {TRAIT_HEALTHY}
                {TRAIT_QUICK}
            [/modifications]
            x,y=3,1
        [/unit]
        [event]
            name=unit placed
            first_time_only=no
            id=side_5_scout_units_xp
            [filter]
                side=5
                type=Dwarvish Scout
            [/filter]
            {VARIABLE_OP units_experience rand "0..{ON_DIFFICULTY 14 15 17}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        [event]
            name=unit placed
            first_time_only=no
            id=side_5_first_units_xp
            [filter]
                side=5
                type=Dwarvish Steelclad, Dwarvish Thunderguard, Dwarvish Stalwart
            [/filter]
            {VARIABLE_OP units_experience rand "{ON_DIFFICULTY 0 2 4}..{ON_DIFFICULTY 28 30 32}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        {MOVE_UNIT (id=first_side_5_unit) 7 4}
        {GENERIC_UNIT 5 "Dwarvish Scout" 3 1}
        {MOVE_UNIT (x,y=3,1) 6 3}
        {GENERIC_UNIT 5 "Dwarvish Scout" 3 1}
        {MOVE_UNIT (x,y=3,1) 6 4}
        [unit]
            type=$third_dwarven_leader_type
            side=5
            name=Northaumatis
            id=northaumatis
            experience={ON_DIFFICULTY 11 13 15}
            canrecruit=yes
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
            x,y=3,1
        [/unit]
        {BUILD_CAMP (id=northaumatis) 3 2}
        {GENERIC_UNIT 5 "Dwarvish Stalwart" 3 1}
        {BUILD_TENT_VILLAGE (x,y=3,1) 2 1}
        [capture_village]
            side=5
            x,y=2,1
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
        {GENERIC_UNIT 5 "Dwarvish Thunderguard" 3 1}
        {BUILD_CAMP (x,y=3,1) 5 2}
        {GENERIC_UNIT 5 "Dwarvish Steelclad" 3 1}
        {BUILD_TENT_VILLAGE (x,y=3,1) 5 4}
        [capture_village]
            side=5
            x,y=5,4
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
        [remove_event]
            id=side_5_first_units_xp
        [/remove_event]
        [remove_event]
            id=side_5_scout_units_xp
        [/remove_event]
        {BUILD_CAMP (id=northaumatis) 3 3}
        {BUILD_TENT_VILLAGE (x,y=2,1) 2 2}
        [capture_village]
            side=5
            x,y=2,2
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
        {BUILD_CAMP (x,y=5,2) 5 3}
        {BUILD_TORCH_UP (x,y=5,4) 4 5 (4,4-5) (4,5)}
        {BUILD_CAMP_KEEP (id=northaumatis) 4 2}
        {BUILD_TORCH_UP (x,y=2,2) 1 2(1-2,1) (1,2)}
        {BUILD_TORCH_UP (x,y=5,3) 7 3 (6-8,7) (2,3)}
        {BUILD_CAMP (x,y=4,5) 5 5}
        {BUILD_CAMP (x,y=7,3) 6 2}
        [unit]
            type="Dwarvish Cannoner"
            side=5
            experience={ON_DIFFICULTY 12 17 22}
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_QUICK}
            [/modifications]
            x,y=3,1
        [/unit]
        {MOVE_UNIT (x,y=3,1) 7 6}
        [micro_ai]
            side=5
            ai_type=lurkers
            action=add
            [filter]
                id=northaumatis
            [/filter]
            [filter_location]
                x,y=4,2
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=5
            ai_type=lurkers
            action=add
            [filter]
                x,y=5,5
            [/filter]
            [filter_location]
                x,y=5,5
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=5
            ai_type=lurkers
            action=add
            [filter]
                x,y=6,2
            [/filter]
            [filter_location]
                x,y=6,2
            [/filter_location]
        [/micro_ai]
    [/event]
    [event]
        name=side 4 turn 19 refresh
        [modify_ai]
            action=delete
            side=4
            path=aspect[avoid].facet[0]
        [/modify_ai]
        [micro_ai]
            side=4
            ai_type=fast_ai
            action=add
        [/micro_ai]
        {SPEAKING ([filter_location]
        x=1
        y=12
    [/filter_location]) "Huh"}
        [move_unit]
            [filter_location]
                x=1
                y=12
            [/filter_location]
            to_x=3
            to_y=10
        [/move_unit]
        {SPEAKING ([filter_location]
        x=6
        y=15
        radius=6
    [/filter_location]) "Reinforcements!"}
        [move_unit]
            [filter_location]
                x=6
                y=15
                radius=6
            [/filter_location]
            to_x=16
            to_y=15
        [/move_unit]
        [unit]
            type=Dwarvish Pathfinder
            side=4
            id=first_side_4_scout
            experience={ON_DIFFICULTY 15 21 27}
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_INTELLIGENT}
                {TRAIT_LOYAL}
            [/modifications]
            x,y=1,12
        [/unit]
        [event]
            name=unit placed
            first_time_only=no
            id=side_4_scouts_xp
            [filter]
                side=4
                type=Dwarvish Pathfinder,Dwarvish Scout
            [/filter]
            {VARIABLE_OP units_experience rand "{ON_DIFFICULTY 0 2 4}..{ON_DIFFICULTY 28 30 32}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        {BUILD_CAMP (id=first_side_4_scout) 12 15}
        {THREE_TRAITS_LOYAL_UNIT 4 "Dwarvish Pathfinder" 1 12}
        {BUILD_TORCH_UP (x,y=1,12) 11 18 (10-11,11) (17,18)}
        {BUILD_CAMP (x,y=11,18) 10 18}
        {THREE_TRAITS_LOYAL_UNIT 4 "Dwarvish Pathfinder" 1 12}
        {BUILD_CAMP (x,y=1,12) 6 14}
        [unit]
            type=$fourth_dwarven_leader_type
            side=4
            name=Glamtharol
            id=glamtharol
            experience={ON_DIFFICULTY 17 28 39}
            canrecruit=yes
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_HEALTHY}
            [/modifications]
            x,y=1,12
        [/unit]
        [set_extra_recruit]
            extra_recruit=Dwarvish Pathfinder, Dwarvish Steelclad, Dwarvish Runesmith, Dwarvish Stalwart, Dwarvish Thunderguard
            id=glamtharol
        [/set_extra_recruit]
        {BUILD_CAMP_KEEP (id=glamtharol) 7 17}
        {THREE_TRAITS_LOYAL_UNIT 4 "Dwarvish Pathfinder" 1 12}
        {BUILD_CAMP (x,y=1,12) 7 16}
        {THREE_TRAITS_LOYAL_UNIT 4 "Dwarvish Pathfinder" 1 12}
        {BUILD_CAMP (x,y=1,12) 9 16}
        {THREE_TRAITS_LOYAL_UNIT 4 "Dwarvish Pathfinder" 1 12}
        {BUILD_TENT_VILLAGE (x,y=1,12) 6 16}
        [remove_event]
            id=side_4_scouts_xp
        [/remove_event]
        [capture_village]
            side=4
            x,y=6,16
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
        {BUILD_CAMP (x,y=7,16) 8 16}
        {BUILD_CAMP (x,y=9,16) 9 17}
        {BUILD_TENT_VILLAGE (x,y=6,16) 6 17}
        [capture_village]
            side=4
            x,y=6,17
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
        {BUILD_TORCH_UP (x,y=8,16) 8 16 (7-9,8) (16,15)}
        {BUILD_CAMP (x,y=9,17) 10 16}
        {BUILD_TENT_VILLAGE (x,y=6,17) 7 18}
        [capture_village]
            side=4
            x,y=7,18
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
        {BUILD_CAMP (x,y=8,16) 8 17}
        [unit]
            type="Dwarvish Cannoner"
            side=4
            experience={ON_DIFFICULTY 21 31 41}
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_HEALTHY}
            [/modifications]
            x,y=1,12
        [/unit]
        {MOVE_UNIT (x,y=1,12) 8 16}
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            [filter]
                id=first_side_4_scout
            [/filter]
            [filter_location]
                x,y=12,15
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            [filter]
                x,y=6,14
            [/filter]
            [filter_location]
                x,y=6,14
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            [filter]
                x,y=10,18
            [/filter]
            [filter_location]
                x,y=10,18
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=lurkers
            action=add
            [filter]
                id=glamtharol
            [/filter]
            [filter_location]
                x,y=7,17
            [/filter_location]
        [/micro_ai]
        [modify_side]
            side=4
            gold=999999
            recruit=""
            [ai]
                aggression=0.80
                caution=0.20
            [/ai]
        [/modify_side]
        {SPEAKING (id=dwarven_citadel_leader) "Oh hell we really need some more dwarves here!"}
    [/event]
    [event]
        name=side 6 turn 24 refresh
        {SPEAKING (side=1
        [filter_location]
        x=8
        y=1
        radius=6
    [/filter_location]) "Reinforcements!"}
        [move_unit]
            [filter_location]
                x=13
                y=1
                radius=3
            [/filter_location]
            to_x=19
            to_y=3
        [/move_unit]
        [move_unit]
            [filter_location]
                x=9
                y=2
                radius=2
            [/filter_location]
            to_x=13
            to_y=6
        [/move_unit]
        [move_unit]
            [filter_location]
                x=8
                y=5
            [/filter_location]
            to_x=13
            to_y=6
        [/move_unit]
        [event]
            name=unit placed
            first_time_only=no
            id=side_6_berserkers_units_xp
            [filter]
                side=6
                type=BfBH Dwarvish Berserker
            [/filter]
            {VARIABLE_OP units_experience rand "{ON_DIFFICULTY 30 35 40}..{ON_DIFFICULTY 68 69 70}"}
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=experience
                    set=$units_experience
                [/effect]
            [/modify_unit]
        [/event]
        {THREE_TRAITS_LOYAL_UNIT 6 "BfBH Dwarvish Berserker" 8 1}
        {MOVE_UNIT (x,y=8,1) 8 5}
        {THREE_TRAITS_LOYAL_UNIT 6 "BfBH Dwarvish Berserker" 9 1}
        {MOVE_UNIT (x,y=9,1) 15 2}
        {BUILD_CAMP (x,y=8,5) 8 5}
        {BUILD_CAMP (x,y=15,2) 15 2}
        {BUILD_TORCH_UP (x,y=8,5) 8 5 (7-9,8) (5,4)}
        {THREE_TRAITS_LOYAL_UNIT 6 "BfBH Dwarvish Berserker" 9 1}
        {BUILD_CAMP (x,y=9,1) 11 3}
        {THREE_TRAITS_LOYAL_UNIT 6 "BfBH Dwarvish Berserker" 9 1}
        {BUILD_CAMP (x,y=9,1) 11 2}
        {THREE_TRAITS_LOYAL_UNIT 6 "BfBH Dwarvish Berserker" 9 1}
        {BUILD_TENT_VILLAGE (x,y=9,1) 9 2}
        {BUILD_CAMP (x,y=11,3) 10 3}
        {BUILD_TORCH_UP (x,y=11,2) 11 2 (10-12,11) (1,2)}
        {BUILD_TENT_VILLAGE (x,y=9,2) 9 3}
        {BUILD_CAMP (x,y=10,3) 9 4}
        {BUILD_CAMP (x,y=11,2) 12 2}
        {BUILD_TENT_VILLAGE (x,y=9,3) 8 3}
        [unit]
            type=BfBH Dwarvish Berserker
            side=6
            name=Nardurras Wild Axewielder
            id=nardurras
            canrecruit=yes
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
            [/modifications]
            x,y=9,1
            [variables]
                title_gained=yes
            [/variables]
        [/unit]
        {BUILD_CAMP_KEEP (id=nardurras) 10 2}
        [capture_village]
            side=6
            x,y=8,3
        [/capture_village]
        [capture_village]
            side=6
            x,y=9,3
        [/capture_village]
        [capture_village]
            side=6
            x,y=9,2
        [/capture_village]
        [redraw]
            side=1
        [/redraw]
        [micro_ai]
            side=6
            ai_type=lurkers
            action=add
            [filter]
                id=nardurras
            [/filter]
            [filter_location]
                x,y=10,2
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=6
            ai_type=lurkers
            action=add
            [filter]
                x,y=8,5
            [/filter]
            [filter_location]
                x,y=8,5
            [/filter_location]
        [/micro_ai]
        [micro_ai]
            side=6
            ai_type=lurkers
            action=add
            [filter]
                x,y=15,2
            [/filter]
            [filter_location]
                x,y=15,2
            [/filter_location]
        [/micro_ai]
    [/event]
    [event]
        name=sighted
        [filter]
            side=7
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        {SPEAKING (x,y=$x2, $y2) "What are nagas doing here?"}
        {SPEAKING (x,y=$x1, $y1) "Putting dwarvesss on their placesss."}
        {SPEAKING (x,y=$x2, $y2) "Well... maybe we could team up?"}
        [modify_side]
            side=7
            team_name=bandits
        [/modify_side]
        {SPEAKING (x,y=$x1, $y1) "Of courssse..."}
    [/event]
    [event]
        name=sighted
        [filter]
            side=8
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [sound]
            name=hiss.wav
        [/sound]
        {SPEAKING (x,y=$x1, $y1) "Hss"}
        {SPEAKING (x,y=$x2, $y2) "What the hell is that!?"}
    [/event]
    [event]
        name=sighted
        [filter]
            race=wolf
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [sound]
            name=wolf-growl-1.ogg
        [/sound]
        {SPEAKING (x,y=$x1, $y1) "Wooof"}
        {SPEAKING (x,y=$x2, $y2) "I've heard about cave bears... but this has to be joke!"}
    [/event]
    [event]
        name=sighted
        [filter]
            side=4
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        {SPEAKING (x,y=$x1, $y1) "Human bandits joined the fight!!!"}
    [/event]
    [event]
        name=sighted
        [filter]
            id=dwarven_citadel_leader
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        {SPEAKING (x,y=$x2, $y2) "That brat is probably hiding in the city citadell."}
        {SPEAKING (id=jareth) "Hand out that bandit you are hiding!"}
        {SPEAKING (x,y=$x1, $y1) "I won't talk with bandits, you'll all die, once Northaumatis Beardlord will return!"}
        {SPEAKING (id=jareth) "Siege the citadel, that thief can't escape anyways!"}
    [/event]
    [event]
        name=sighted
        [filter]
            side=5
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        {SPEAKING (x,y=$x1, $y1) "Who are you? What are humans doing in these tunnels?"}
        {SPEAKING (x,y=$x2, $y2) "Another dwarves!???"}
        {SPEAKING (x,y=$x1, $y1) "Intruders in city!!!"}
    [/event]
    [event]
        name=sighted
        [filter]
            side=6
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [sound]
            name=dwarf-laugh.wav
        [/sound]
        {SPEAKING (x,y=$x1, $y1) "Muha-ha-ha-ha-ha-ha!"}
        {SPEAKING (x,y=$x2, $y2) "That can happen only to us!"}
    [/event]
    [event]
#TODO if ported to 1.18+ add this as achievement
#TODO change it dependion on how many creators were discovered, amount of coins stays same
        name=moveto
        [filter]
           side=1
            x,y=9,23
        [/filter]
        [unit]
            type=Elder Mage
            x,y=9,23
            name=ZombieKnightCZ
            unrenamable=yes
            id=creator
            side=1
            passable=yes
            animate=yes
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_INTELLIGENT}
            [/modifications]
            [variables]
                title_gained=yes
            [/variables]
        [/unit]
        {SPEAKING (id=creator) "Hi!"}
        {SPEAKING (id=creator) "I've created this campaign."}
        {SPEAKING (id=creator) "I'm just wondering what are you doing there."}
        {SPEAKING (id=creator) "Here, two coins for you."}
        [store_side]
            side=1
        [/store_side]
        [modify_side]
            side=1
            gold="$($side.gold + 2)"
        [/modify_side]
        [sound]
            name=gold.ogg
        [/sound]
        [delay]
            time=1000
            accelerate=no
        [/delay]
        [kill]
            id=creator
        [/kill]
    [/event]
    [event]
        name=last breath
        [filter]
            id="jareth"
        [/filter]
        [kill]
            id=jareth
            animate=yes
        [/kill]
        [music]
            name=sad.ogg
            append=no
        [/music]
        [music]
            name=defeat.ogg
            play_once=yes
        [/music]
        #  {FADE_STEP -512 0}
        #  [kill]
        #  [/kill]
        [change_theme]
            theme=Cutscene_Minimal
        [/change_theme]
        #  [place_shroud]
        #      [filter_side]
        #      [/filter_side] 
        #  [/place_shroud]
        {NARRATION () "Everything goes dark, and you die."} #TODO
        {DELAY 60000 no}
        {NARRATION () "... You're dead ..."}
        {DELAY 30000 no}
        {NARRATION () "... And there's no afterlife ..."}
        {DELAY 30000 no}
        {NARRATION () "... Everything is black and death ..."}
        {DELAY 30000 no}
        {NARRATION () "... Darkness, forever ..."}
        {DELAY 30000 no}
        {NARRATION () "... If you would behave just a bit better ..."}
        {DELAY 30000 no}
        {NARRATION () "... We could still see colors ..."}
        {DELAY 30000 no}
        {NARRATION () "... I miss them ..."}
        {DELAY 30000 no}
        {NARRATION () "... YOU miss them..."}
        {DELAY 30000 no}
        {NARRATION () "... Your corpse it's eaten down by wildlife ..."}
        {DELAY 30000 no}
        {NARRATION () "... Hey ..."}
        {DELAY 30000 no}
        {NARRATION () "... ..."}
        {DELAY 30000 no}
        {NARRATION () "..."}
        {DELAY 30000 no}
        {NARRATION () "."}
        {DELAY 30000 no}
        {NARRATION () ""}
        {DELAY 999999999 no}
        {NARRATION () "Why are you still here?"}
        #TODO
        #CHANGE OBJECTIVES, maybe some more things
        #objective "Yes this is The End."
        #WIKI... IT DOESNT MATTER at all... 
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id="wenrys"
        [/filter]
        {SPEAKING (x,y=$x2, $y2) "Die! You scum!"}
        {SPEAKING (id=jareth) "Finally got that traitor!"}
        [store_unit]
            [filter]
                side=4
            [/filter]
            variable=side_4_unit
        [/store_unit]
        {SPEAKING (id=$side_4_unit.id) "We failed to protect that human noble!"}
        {SPEAKING (id=wenrys) "Agh..h..."}
        [kill]
            id=wenrys
            animate=yes
        [/kill]
        {VARIABLE wenrys_objective_description "Get your gold back"}
        {STORY_HOARD_OF_GOLD_MUSTTAKE $x1 $y1 wenrys_gold}
        {PLACE_ITEM_SMOKEBOMBS $x1 $y1 smokebombs_wenrys 3}
        [show_objectives]
        [/show_objectives]
    [/event]
    [event]
        name=last breath
        [filter]
            id=dwarven_citadel_leader
        [/filter]
        {VARIABLE dwarven_citadel_leader_is_death yes}
        {SPEAKING (id=dwarven_citadel_leader) "But... how?"}
        {SPEAKING (x,y=$x2, $y2) "..."}
        [kill]
            id=dwarven_citadel_leader
            animate=yes
        [/kill]
        [switch]
            variable=dwarven_magic_item
            [case]
                value="Boots of speed"
                {PLACE_ITEM_BOOTS_OF_SPEED $x1 $y1 boots_of_speed_dwarven_leader}
            [/case]
            [case]
                value="Breastplate of the mighty"
                {PLACE_ITEM_BREASTPLATE_OF_THE_MIGHTY $x1 $y1 breastplate_of_the_mighty_dwarven_leader}
            [/case]
            [case]
                value="Diadem of intelligence"
                {PLACE_ITEM_DIADEM_OF_INTELLIGENCE $x1 $y1 diadem_of_intelligence_dwarven_leader}
            [/case]
            [case]
                value="Ring of strengt"
                {PLACE_ITEM_RING_OF_STRENGT $x1 $y1 ring_of_strengt_dwarven_leader}
            [/case]
            [case]
                value="Huntsmans hat"
                {PLACE_ITEM_HUNTSMANS_HAT $x1 $y1 huntsmans_hat_dwarven_leader}
            [/case]
            [case]
                value="Ankh"
                {PLACE_ITEM_ANKH $x1 $y1 ankh_dwarven_leader}
            [/case]
        [/switch]
        [store_unit]
            [filter]
                side=4
            [/filter]
            variable=side_4_unit
        [/store_unit]
        {SPEAKING (id=$side_4_unit.id) "No!!!"}
        {VARIABLE citadel_objective_description "Kill 'em all" }
        {VARIABLE citadel_objective_show true}
        [store_unit]
            [filter]
                side=7
                [not]
                    [filter_location]
                        terrain=W*^*,S*^*
                    [/filter_location]
                [/not]
                [and]
                    [not]
                        [filter_location]
                            x,y=44,3
                            radius=3
                        [/filter_location]
                    [/not]
                [/and]
            [/filter]
            variable=side_7_retreat_micro_ai
        [/store_unit]
        [micro_ai]
            side=7
            ai_type=goto
            action=add
            ignore_enemy_at_goal=yes
            ca_score=300000
            [avoid]
                [not]
                [/not]
            [/avoid]
            [filter]
                find_in=side_7_retreat_micro_ai
            [/filter]
            [filter_location]
                x,y=36,7
                radius=2
            [/filter_location]
        [/micro_ai]
        {SPEAKING (side=7) "Humansss hold the town, we'll cut off reinforcementzzz until they'll be ... sss ... ready to negotiate!"}
        [event]
            name=moveto
            first_time_only=no
            [filter]
                side=7
                [filter_location]
                    x,y=36,7
                    radius=2
                [/filter_location]
            [/filter]
            [lua]
                code=<<
for i = wml.variables["side_7_retreat_micro_ai.length"], 0, -1 do
    if wml.variables["side_7_retreat_micro_ai["..i.."].id"] == wml.variables["unit.id"] then
        wml.variables["side_7_retreat_micro_ai["..i.."]"] = nil
    end
end
>>
            [/lua]
        [/event]
        [modify_ai]
            side=7
            action=add
            path=aspect[avoid].facet[]
            [facet]
                [value]
                    [not]
                        terrain=W*^*,S*^*
                    [/not]
                    [and]
                        [not]
                            x,y=44,3
                            radius=3
                        [/not]
                    [/and]
                [/value]
            [/facet]
        [/modify_ai]
        [show_objectives]
        [/show_objectives]
    [/event]
    [event]
        name=last breath
        [filter]
            id=progi
        [/filter]
        [store_unit]
            [filter]
                id=progi
            [/filter]
            variable=is_this_unit_visible
        [/store_unit]
        [if]
            [have_location]
                x,y=$is_this_unit_visible.x,$is_this_unit_visible.y
                [filter_vision]
                    side=1
                [/filter_vision]
            [/have_location]
            [then]
                {SPEAKING (id=progi) "Grr-r, time to retreat!"}
            [/then]
        [/if]
        {CLEAR_VARIABLE is_this_unit_visible}
        [store_unit]
            [filter]
                id=progi
            [/filter]
            variable=progi_stored
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                side=9
                race=goblin
                [filter_vision]
                    side=1
                [/filter_vision]
                [or]
                    side=9
                    type=Wolf Rider,Goblin Knight,Direwolf Rider,Goblin Pillager
                    [filter_vision]
                        side=1
                    [/filter_vision]
                [/or]
            [/filter]
            variable=side_9_unit
        [/store_unit]
        {SPEAKING (id=$side_9_unit.id) "I hear cheef. I go."}
        [micro_ai]
            side=9
            [filter]
                race=goblin
                [or]
                    type=Wolf Rider,Goblin Knight,Direwolf Rider,Goblin Pillager
                [/or]
            [/filter]
            ai_type=goto
            action=add
            ignore_enemy_at_goal=yes
            [filter_location]
                x,y=48,27
            [/filter_location]
        [/micro_ai]
        [event]
            name=moveto
            first_time_only=no
            [filter]
                side=9
                x,y=48,27
            [/filter]
            [store_unit]
                [filter]
                    x,y=48,27
                [/filter]
                variable=goblins_escaped
                kill=yes
                mode=append
            [/store_unit]
        [/event]
    [/event]
    [event]
        name=side 9 turn refresh
        first_time_only=yes
        [filter_condition]
            [variable]
                name=dwarven_citadel_leader_is_death
                equals=yes
            [/variable]
            [and]
                [variable]
                    name=turn_number
                    greater_than_equal_to=32
                [/variable]
            [/and]
        [/filter_condition]
        [unit]
            type=Goblin Hunter
            name= _ "Goro"
            side=9
            x,y=44,16
            facing=sw
            id=goblin_assassin_1
            experience={ON_DIFFICULTY 4 3 2}
            animate=yes
        [/unit]
        {SPEAKING (id=goblin_assassin_1) "Timeto a'ssinate you, you stiky dwourf!"}
        [unit]
            type=Goblin Assassin
            name= _ "Guru"
            side=9
            x,y=42,17
            facing=ne
            id=goblin_assassin_2
            experience={ON_DIFFICULTY 21 17 13}
            animate=yes
        [/unit]
        {SPEAKING (id=goblin_assassin_2) "Oh, heisnt 'ere!"}
        {SPEAKING (id=goblin_assassin_2) "I've told you that this isn't the right way."}
        {SPEAKING (id=jareth) "How did you get here?"}
        {SPEAKING (id=goblin_assassin_1) "Whos tat?"}
        {SPEAKING (id=goblin_assassin_2) "A human?"}
        {SPEAKING (id=goblin_assassin_1) "That friend?"}
        {SPEAKING (id=goblin_assassin_2) "What are you doing there man?"}
        {SPEAKING (id=jareth) "We've killed dwarf leader a while ago."}
        {SPEAKING (id=jareth) "You know a way out of there! Let us follow you out!"}
        {SPEAKING (id=goblin_assassin_1) "'eee help friendas!"}
        {SPEAKING (id=goblin_assassin_2) "Indeed, you see that wall? That's a passage, that crack in the wall."}
        {MOVE_UNIT(id=goblin_assassin_2) 43 22}
        [terrain]
            x=43-44
            y=23
            terrain=Uh
        [/terrain]
        [redraw]
            side=1
        [/redraw]
        {SPEAKING (id=goblin_assassin_2) "I'll tell it to our chief!"}
        {MOVE_UNIT(id=goblin_assassin_2) 48 27}
        [modify_side]
            side=9
            team_name=wild,bandits
        [/modify_side]
        ### TODO first objective: kick them into asses -> escape with goblins
        ### if gold picked up, and if killed wenrys change the dialog
        ### goblins then dissaper
        {VARIABLE citadel_objective_description "Run, run, run!" }
        {VARIABLE retreting_objective_note_show true}
        [show_objectives]
        [/show_objectives]
        [event]
            name=moveto
            first_time_only=no
            [filter]
                side=1
                x,y=48,27
            [/filter]
            [if]
                [variable]
                    name=unit.id
                    equals="jareth"
                [/variable]
                [then]
                    #TODO ?how many units are still in field
                    {SPEAKING (id=jareth) "Sorry, guys but we can't wait no more!"}
                    [if]
                        [have_unit]
                            id=wenrys
                        [/have_unit]
                        [then]
                            #TODO black cutscene
                            #TODO NARRATION...
                            # You're runnig throught the tunnels
                            # What a coward sollution... all gold left behind, real men would fight for it!
                            # Flash of the gold commes on your mind
                            # Hell so much gold... so close...
                            # Nevermind
                            # It's good now, you think.
                            # delay 2000
                            # Evenything goes dark and you die.
                            # WAIT WHAAAT, NO!
                            # As you were thinking about lost gold you felt over rock and killed yourself imediatelly.
                            # You can't just say that I've died.
                            # It's not like I would wish that.
                            # Maybe if you wouldn't cowardly run of ... it won't happen.
                            # title over the screen "Blackness"
                        [/then]
                        [else]
                            {VARIABLE_OP scenario_number add 1}
                            [endlevel]
                                result=victory
                                bonus=no
                                {NEW_GOLD_CARRYOVER 40}
                            [/endlevel]
                        [/else]
                    [/if]

                    ### TODO REMOVE THIS ONCE THE NARRATION WILL BE COMPLETE
                    {VARIABLE_OP scenario_number add 1}
                    [endlevel]
                        result=victory
                        bonus=no
                        {NEW_GOLD_CARRYOVER 40}
                    [/endlevel]
                [/then]
                [else]
                    #TODO NARRATOR "And so $unit.name || escapes"
                [/else]
            [/if]
            [store_unit]
                [filter]
                    x,y=48,27
                [/filter]
                variable=bandits_escaped
                kill=yes
                mode=append
            [/store_unit]
        [/event]
        [event]
            name=moveto
            first_time_only=yes
            [filter]
                side=1
                [filter_location]
                    x,y=48,27
                    radius=4
                [/filter_location]
            [/filter]
            [event]
                name=side 9 turn refresh
                first_time_only=yes
                [if]
                    [have_unit]
                        id=progi
                    [/have_unit]
                    [then]
                        {SPEAKING (id=progi) "All right, we're retreating!"}
                        {SPEAKING (id=progi) "Goblins in field will protect our retreat."}
                        [store_unit]
                            [filter]
                                id=progi
                            [/filter]
                            variable=progi_stored
                            kill=yes
                        [/store_unit]
                    [/then]
                    [else]
                        #TODO NARRATOR SPEAKS "You run to retreat throught tunnels, goblins marked you the route."
                    [/else]
                [/if]
                {HIGHLIGHT_IMAGE 48 27 items/gohere-green.png ()}
            [/event]
        [/event]
    [/event]
[/scenario]
#TODO cannoner attacks_left=0

#TODO move titles into global and prestart

#TODO custom [animation] and set flag=selected

#Spearman, Bowman, Short Swordsman, Dwarves all except gryphon and berserker(done) lvl1 and lvl2 Giant Spider

#TODO rework parry, flee, so it doesn't pop-up on every unit

####### BALANCE
# lone wolf overpovered

#todo unselect hex, when kill unit

#TODO clear shroud right after exit_hex
# knockback don't count down from moves (isn't on turn so it's no a problem)


#TODO my move check if the hex is still empty
#TODO knockback deal damage, if cannot push
#TODO make general move, better, all checks
# storming should move if enemy flees


#KDYZ JEDNOTKA ZDRHNE DO VESNICE A VYVOLA JEDNOTKU NA SVE STARE MISTO POKRYT!!!


#TODO human generals get Sir- prefix

#TODO when both abilities substitutu the moves needed to move on the tile, if the unit is on turn

#TODO portrrait for Jatreth

#TODO in the end add ability list for zombies

# umc terrain pack forest fire
# reflections add-on

# vizualize some abilities

#TODO finish slow remove and fast remove events!, deal damage only after healing in villages
# when hitted make floating crippled
#bleed don't replace overlay?
#communicate the size of the stack
#make bleed object different
#~more lines for traits//effects
# make image recolor more research!!!
# sidebar line moe vertical space

#more parted abilities can be merged using WFL/Lua

#TODO RINGING EARS make it status, give it icon
#TODO BLEEDING, CRIPPLED

# crashes WESNOTH, repeatedly
#  [chance_to_hit]
#      id=flee
#      name= _ "flee"
#      female_name= _ "female^flee"
#      description=_ "When faced with imminent defeat, the unit can execute a strategic retreat, swiftly disengaging from combat to avoid certain death.
    
#  The more space this unit has around, the more likely it can evade."
#      special_note=_ "This unit can flee combat, to fight another day."
#      apply_to=opponent
#      divide=2
#      [filter_self]
#          formula=<<(self.wml_vars.flee = "yes")>>
#      [/filter_self]
#  [/chance_to_hit]

## inked on non-ever-inked units
### WEAPONS WITH SAME NAME BREAKS SOME ABILITIES

#crippling blow - kida breaks the animation mabe my/1.18.0 issue
#DRUMBEAT NOW
# ADAPTIVE ARMOR FINISH IT!
# protection
#INSPECT HOW IT CHANCE TO HIT WORK IN COMBO WITH OTHER ABILITIES
# stacking effects statuses
# make bleed stack
#BLEED REMAKE

##############SPECIALS#################
# -- weapon special +1/50% strikes on defend

# -- when misses 2 times in a row, must hit next time
#Armor -X damage
#thorns
#beam
#beauty
#blood magic - but opponet, (unblockable damage)
#blur
#suprise
#MY OWN/// inspired from steppe abilities hunn CURSE
#special giving cursed special
# ~ dazzle
# ~ Some cool effect for critical special
#double attack
#NOT_FOR_NOW - dragon breath
#MY evade (increases evasion chance in way core "parry" doesn't)
#hex
#highground
#ink -- I HAVE THIS ALREADY, but I can make something like longer than one battle lasting/ different distribution of it
#NOT_NOW magic conter
#NOT NOW mind fog
#nighteye ~
#point blank - I LIKE THE NAME AND COULD BE IMPLEMENTED WITH BOW
# mabybe point-blank == both melee and ranged?
# flee = 100% evade chance when damage>health
#sapper = defence increases damage
#sculpts -- for naga warrior/fighter
#soul taker
#MY OWN spores// name makes dangerous terrain
#stardust
# USE MY STUN SOMEWHERE?
#swallow
#very skilled 60%
#wind-up

#############ABILITIES#############

# voice of darkness // ?
#trapping - rename
#tentacle spawn
#tame ?INTERESTING IDEA
#sustance
#summon undead -- GOOD , AMAZING ANIMATION!!!
# SUMMON ///THERES A LOT OF THEM, INSPECT, asked Ravana
#statue copy - INSPIRATION?
# leaving trail of corrupted terrain (acid maybe), which disapears over time, bt deals damage for ~three / ~one turn
#split -BOTH SAME NAMED VARIANTS
#halves enemy armor, doubles enemy's vulnerabilities
# not for cave-species shadow-veil
#saga BUT gives morale boost
#sacrifise
#runelaying ... unit that metamorphoses, getting three turn long bonuses based on it's actions
#rune aura IDEA 
# replication - for ghosts (Ilusions)
# reincarnation
# rat pack
# protection. only for weak ... variation only for strong/leaders Guardian/bodyguard
# three turns lasting buff for adjacent allies
#pain chaining
#~pack tactic
#fury
#furious death
#formation
#forage // maybe one more
#Cold aura
#Beast tamer
#battle tutor
#TOOLTIPS FOR IMAGES (gold, willage too)
#abilities/ weapon specials half-way there:
# flee, opportunist, 
# brokken armor + armor piercing goes too low
# entagle working at
# fire stronger in woods, weak in water?
#Surprise Charge https://github.com/ProditorMagnus/Ageless-for-1-14/blob/97d45acf399382b4c54aba58bfd75092ecec70f1/data/ME_data/abilities/suprise.cfg#L4
#If this cavalry begins its turn with maximum movement and attacks an enemy who cannot see it at the start of that turn, it deals double damage.
#TODO WHAT TO DO WITH UNDEAD IN MARK ABILITY
#########################################################NOW TANGLED_SLAUGHTER
###GIVE ARMOR TO ARMORED UNITS naga decrease for un-armored, ...

# MORALE/HORROR system???
#TODO in descriptions say exact numbers, once they'll be balanced


#TODO pro +4 healing, pozor na regeneraci +8, +4

#WATCH out for duplicate object
#TODO custom ability never gray
#TODO make special notes and desctiptions of abilities and specials
#NARRATION BAD AT start AND at Main_map

#TODO clear chat when leader death
#narraion sometimes black around text(but seems stable)
#make finall map touches

# IMAGE webp

### TODO put load count into local variable on reload
### side 4) 7 turns
### side 6) 8 turns
### side 2) 10 turns


#TODO PRINT LOAD_COUNT

#dwarves cannon add FIRED sound
# ART_LICENSE
# TODO naga leader protect, then retreat
# 1.18 Turn 20+ nagas turn too long#TODO
# Maybe make item bag of gold(-2 moves, -10% evasion chance, unable to attack) ,needed to carry into the next scenario, throught it until s04

# first explosion = fire_event fire $i explosion message after explosion 
# Narration You hear s swish sound and ... # Jaterh What the hell was that? # Narrator Dwarves brought siege cannons to "vykourit vas"

### 3 lvl2 units + 30 gold
#todo add note and say, that unit left behind are lost, jareth escapes=endlevel
############################# NOW PLAYTEST AND BALANCE!!!
#NARRATION #TODO how to put it into the center?
# show when unit hidden, filter if you see the tile(ambush????) use Lua
# story=false/true change the widght
# background image (think about the map)
# get unit's image and display it
# left_image=
# right_image=


#make s02, s01 story
# add bandits on story images
#TODO STORY WP check the right season... does 6k work same as the 1k, does smaller need to be upsized?
#TODO STORY add there bandits
#TODO oldania in campaing descriptions
#TODO music, defeat for both s01, s02
#TODO kill mesages for dwarven leader in 1st scenario, jareth, assassin, saurian, leader naga, dwarven leader...
#custom win screen?

#TODO naga defend leader event
#move units out of the way s01 cinematic marshal and cavalry
#SPIDERS    #TODO spawning from eggs
            #TODO NOT WALL SPAWNING

### NARRAITONS
### s01 death message
### TALK_CHOICE think about it(without overlay, two clickable lines)
### VOICE THEM



### IDEAS, LOOK IMPROVE
### PAK UDELAT GOBLIN SPAWN GETABLE TILES ONLY!!!! animate the move there
### spider... stopps spawning when destroyes eggs -> summon guards, bats... stop spawning... then summon a STRONG BAT and 3lvl1 3lvl0
### S01 when rillon killed maybe stop animating that unit? MAke two different events?

### CODE CLEARENCE
### WHEN SPAWNING MONSTERS REPLACE IF WITH [filter_condition]
### WHEN DROP MENU ITEM IS REMOVED/ NO UNIT HAS ITEM EQUIPEDD DONT PUT IT TERE AT THE START
### WHEN SPAWNING MONSTERS REPLACE IF WITH [filter_condition]
### remove unit variables once putted on recall lists, that apllyes also to wenrys stored, villages raided, meory, glerary stored ...

#MAY AND MAY_NOT TASKS
#encampment little def buf?
#TODO edit the soundtrack
#TODO add sounds into events, sound emittors #ambient/wardrums.ogg

######### 1.18 CHECKS #######
#TODO change the speed of explosion when game speeded-up,glitchy animation repair

# rework victory screen
# TODO Konrad2 playtest

### CREDITS

# credits, to _main and .pbl
# modding
# celticminstrel, Ravana, Durzi, Anekron, amakri, sevu, Pentarctagon, Soliton, Lord_Knightmare, 
### NAHORU OD TED JEN ZAVAZNA TEMATA ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
#FIX show objectives at enemys turn (like goblin ones) #github bug report

# TRANSLATION:
# _ put before text, not before macros
# https://github.com/ProditorMagnus/Ageless-for-1-14/commit/b6cc1809722dce56a731d57b6bce1d72aab8f0be#diff-9326ba1a3d311b89ad1f5941c4fab19f99b39ff6af7e26f22cac75458b6949c1

#GUI2 story change text background
### (optional) REMOVE THE daylight at torch main point


#TODO when meory/glerary dies in S01 remove them in S02, modify events correspondingly(still will summon unit when leader death) ADD SOMETHING PLAYER CAN GO FOR 
#(BONUS IN S02, WHICH WOULD BE "theoretically" avaibe even when you won't defeat him) ...
#Torches Macro edge cases
#dalsi linky -prvni scenar utecou jinudy, -3. scenar sef bude zmenen na kostlivce-velitele, dat nemrtvym velitelum plague, stronger plagea a supreme plague
#after the game after finished, change gold descriptions(to more pesimist ones)
# dwarves modify sprites, if wear items
#####change the terrain names in HELP / Wiki
#TODO when scenario starts filter if there are units with items, if not remove droppable menus
# LUA->TOOLTIP->unit_type function elseif for different types
#TODO lvl3 assassin, goblin lvl2, spearthrover saourian advancement
### TODO replace shield messages with spaker with NARRATOR, dont highlight unit not hex, in title "Narrator"
#S01 narrator falling castle dialog
# TORCHES MODIFY FOR EVEN x/y = 0
### ART dvarvish cannoner torch attack #############ART silver crown, other items, goblin lvl2
### remove alchemy
### Crash wesnoth entirely
### file  modify
#sound_emmiters
#custom music in events and dabing for narrator
### Super hard_core mode
#TODO WHEN NAGAS OR SAURIANS TALK ADD ss's in text
#flag_icon=null WORKS ... but NOT
#FIND A WAY TO GIVE A RANDOM RACE and gender NAME (so you can add a title there, check races definition)
# custom trait pools
#flood macro main
### modify save_files? add global variables?
### make dwarvish cannoner picture ask and then ask for the rework
#TODO explosion shake the screnn idk how to look good

############ BOSS FIGHT ######################
##harm "dark spell" that turns dark adepts enemy into its ally for the rest of turn or something like insanity unit cant take commands for one turn
#Turn into ghosts once dark adepts die
#Bloodlust Mind raid and more abilities, check https://wiki.wesnoth.org/WML_Abilities
############

#         [change_theme]
#             theme=Cutscene_Minimal
#         [/change_theme]
#         [item]
#             x=37
#             y=11
#             halo=scenery/white.png
#         [/item]
#         [redraw]
#             side=1
#         [/redraw]

### if theres a if, make sure to not pop out before the game starts
### rename to tooltip_blablabla


#[lua]
            #code=<<
            #--sets poison damage to 4, and rest heal to 0
            #wesnoth.game_config.poison_amount = 4
            #wesnoth.game_config.rest_heal_amount = 0
